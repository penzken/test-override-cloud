import{a as de}from"./DeleteLinkedDocModal-58bed83f.js";import{_ as ce}from"./ErrorPage-f1ea6704.js";import{_ as me}from"./Icon-f8d63d14.js";import{D as j}from"./DetailsIcon-18759e5d.js";import{A as ve,a as pe,u as _e,b as fe,S as be,c as ye}from"./useActiveTabManager-ba8c3899.js";import{E as ge}from"./EmailMultiSelect-9a571b70.js";import{C as Ce}from"./CommentIcon-1ba1196a.js";import{P as he}from"./PhoneIcon-687b9433.js";import{T as we}from"./TaskIcon-4d1dfaf1.js";import{N as ke}from"./NoteModal-52dadb54.js";import{W as xe}from"./WhatsAppIcon-bde39cdc.js";import{I as Ie}from"./IndicatorIcon-2f30d1a9.js";import{O as Ve}from"./OrganizationsIcon-d184acc0.js";import{C as Le}from"./ContactsIcon-e88572ff.js";import{L as Ae}from"./LayoutHeader-0ab09138.js";import{L as F}from"./Link-a0855a11.js";import{g as Me,S as De}from"./view-d56bbd34.js";import{_ as W}from"./CustomActions-faabd076.js";import{b as Re,s as Se,D as Te,e as H}from"./index-8df5241e.js";import{g as Ee}from"./settings-97110a1e.js";import{g as ze}from"./global-0d0156ec.js";import{s as $e}from"./statuses-57fa655e.js";import{u as Oe,d as Ne,e as Ue,_ as qe}from"./modals-47f1cf8a.js";import{i as Pe,w as Be}from"./DragVerticalIcon-3e35903f.js";import{a1 as je,aM as Fe,m as v,z as S,A as K,Y as We,c as f,b as i,w as b,u as t,d as r,g as d,C as m,aK as Y,F as He,aT as L,aS as G,aV as Ke,e as J,f as s,n as Ye,t as w}from"./index-a6920b9f.js";import{_ as Ge}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-7d13eeef.js";import{u as Je}from"./pageMeta-16e1c7dd.js";import"./ListView-3ebdc383.js";import"./Email2Icon-e5467a9c.js";import"./CalendarIcon-28657f45.js";import"./CallLogModal-50e95440.js";import"./EditIcon-127a74cc.js";import"./ArrowUpRightIcon-992c4380.js";import"./LeadsIcon-fdfd4494.js";import"./DealsIcon-97fb4069.js";import"./TaskModal-03a6c87c.js";import"./TextEditor.vue_vue_type_script_setup_true_lang-0d82d5b6.js";import"./helpCenter-a7e44f6b.js";import"./FadedScrollableDiv-6f6cd639.js";import"./FieldLayout-baadb8ff.js";import"./MultipleAvatar-3dcbfb2e.js";import"./event-2ffbd56c.js";import"./ComboboxViewport-5c5445f5.js";import"./IconPicker-929f64f0.js";import"./FileUploader-28868f3a.js";const Qe={class:"relative flex h-10.5 items-center justify-between gap-2 py-2.5 pl-2"},Xe={class:"absolute right-0"},Ze={key:0,class:"flex h-12 items-center justify-between gap-2 border-b px-3 py-2.5"},ea={class:"flex items-center gap-2"},aa={key:1,class:"flex h-full overflow-hidden"},ta={key:0},oa={key:1,class:"flex flex-1 flex-col justify-between overflow-hidden"},sa={class:"mb-4 flex items-center gap-2 text-ink-gray-5"},la={class:"block text-base"},na={class:"ml-6"},ia={class:"flex items-center justify-between text-base"},ra={key:1,class:"mt-2.5 text-base"},ua={class:"mb-4 mt-6 flex items-center gap-2 text-ink-gray-5"},da={class:"block text-base"},ca={class:"ml-6"},ma={class:"flex items-center justify-between text-base"},va={key:1,class:"mt-2.5 text-base"},lt={__name:"MobileLead",props:{leadId:{type:String,required:!0}},setup(k){const{brand:Q}=Ee(),{$dialog:X,$socket:Z}=ze(),{statusOptions:ee,getLeadStatus:ae}=$e(),{doctypeMeta:te}=Re("CRM Lead"),y=je(),U=Fe(),A=k,M=v(""),T=v(""),D=v(!1),{triggerOnChange:oe,assignees:E,document:n,scripts:q,error:se}=Oe("CRM Lead",A.leadId),l=S(()=>n.doc||{});K(se,a=>{var e;a?(M.value=__(a.exc_type=="DoesNotExistError"?"Document not found":"Error occurred"),T.value=__(((e=a.messages)==null?void 0:e[0])||"An error occurred")):(M.value="",T.value="")}),K(()=>n.doc,async a=>{var e;if((e=q.data)!=null&&e.length){let u=await Se(q.data,{doc:a,$dialog:X,$socket:Z,router:U,toast:L,updateField:B,createToast:L.create,deleteDoc:ne,call:G});n._actions=u.actions||[],n._statuses=u.statuses||[]}},{once:!0});const z=v(!1),le=S(()=>{let a=[{label:__("Leads"),route:{name:"Leads"}}];if(y.query.view||y.query.viewType){let e=Me(y.query.view,y.query.viewType,"CRM Lead");e&&a.push({label:__(e.label),icon:e.icon,route:{name:"Leads",params:{viewType:y.query.viewType},query:{view:y.query.view}}})}return a.push({label:P.value,route:{name:"Lead",params:{leadId:A.leadId}}}),a}),P=S(()=>{var e,u;let a=((e=te["CRM Lead"])==null?void 0:e.title_field)||"name";return((u=l.value)==null?void 0:u[a])||A.leadId});Je(()=>({title:P.value,icon:Q.favicon}));const $=S(()=>[{name:"Details",label:__("Details"),icon:j,condition:()=>Pe.value},{name:"Activity",label:__("Activity"),icon:ve},{name:"Emails",label:__("Emails"),icon:ge},{name:"Comments",label:__("Comments"),icon:Ce},{name:"Data",label:__("Data"),icon:j},{name:"Calls",label:__("Calls"),icon:he},{name:"Tasks",label:__("Tasks"),icon:we},{name:"Notes",label:__("Notes"),icon:ke},{name:"Attachments",label:__("Attachments"),icon:pe},{name:"WhatsApp",label:__("WhatsApp"),icon:xe,condition:()=>Be.value}].filter(e=>e.condition?e.condition():!0)),{tabIndex:g}=_e($,"lastLeadTab"),O=We({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections",cache:["sidePanelSections","CRM Lead"],params:{doctype:"CRM Lead"},auto:!0});function B(a,e){e=Array.isArray(a)?"":e;let u=Array.isArray(a)?{}:l.value[a];Array.isArray(a)?a.forEach(x=>l.value[x]=e):l.value[a]=e,n.save.submit(null,{onSuccess:()=>z.value=!0,onError:x=>{var I;Array.isArray(a)?a.forEach(V=>l.value[V]=u[V]):l.value[a]=u,L.error(((I=x.messages)==null?void 0:I[0])||__("Error updating field"))}})}function ne(){D.value=!0}const R=v(!1),C=v(!1),h=v(!1),p=v(""),_=v("");async function ie(){if(C.value&&!p.value){L.error(__("Please select an existing contact"));return}if(h.value&&!_.value){L.error(__("Please select an existing organization"));return}!C.value&&p.value&&(p.value=""),!h.value&&_.value&&(_.value="");let a=await G("crm.fcrm.doctype.crm_lead.crm_lead.convert_to_deal",{lead:A.leadId,deal:{},existing_contact:p.value,existing_organization:_.value});a&&(R.value=!1,C.value=!1,h.value=!1,p.value="",_.value="",Ke("convert_lead_to_deal"),U.push({name:"Deal",params:{dealId:a}}))}async function re(a){await oe("status",a),n.save.submit()}function ue(a){n.save.submit(null,{onSuccess:()=>N(a)})}function N(a){a!=null&&a.hasOwnProperty("lead_owner")&&E.reload()}return(a,e)=>{var I,V;const u=J("Button"),x=J("Dialog");return s(),f(He,null,[i(Ae,null,{default:b(()=>{var o;return[r("header",Qe,[i(t(Ge),{items:le.value},{prefix:b(({item:c})=>[c.icon?(s(),d(me,{key:0,icon:c.icon,class:"mr-2 h-4"},null,8,["icon"])):m("",!0)]),_:1},8,["items"]),r("div",Xe,[l.value?(s(),d(t(Te),{key:0,options:t(ee)("lead",(o=t(n).statuses)!=null&&o.length?t(n).statuses:t(n)._statuses,re)},{default:b(({open:c})=>[l.value.status?(s(),d(u,{key:0,label:l.value.status,iconRight:c?"chevron-up":"chevron-down"},{prefix:b(()=>[i(Ie,{class:Ye(t(ae)(l.value.status).color)},null,8,["class"])]),_:1},8,["label","iconRight"])):m("",!0)]),_:1},8,["options"])):m("",!0)])])]}),_:1}),l.value.name?(s(),f("div",Ze,[i(fe,{modelValue:t(E).data,"onUpdate:modelValue":e[0]||(e[0]=o=>t(E).data=o),doctype:"CRM Lead",docname:k.leadId},null,8,["modelValue","docname"]),r("div",ea,[(I=t(n)._actions)!=null&&I.length?(s(),d(W,{key:0,actions:t(n)._actions},null,8,["actions"])):m("",!0),(V=t(n).actions)!=null&&V.length?(s(),d(W,{key:1,actions:t(n).actions},null,8,["actions"])):m("",!0),i(u,{label:a.__("Convert"),variant:"solid",onClick:e[1]||(e[1]=o=>R.value=!0)},null,8,["label"])])])):m("",!0),l.value.name?(s(),f("div",aa,[i(t(qe),{as:"div",modelValue:t(g),"onUpdate:modelValue":e[5]||(e[5]=o=>Y(g)?g.value=o:null),tabs:$.value,class:"overflow-auto"},{default:b(()=>[i(t(Ne),{class:"!px-3"}),i(t(Ue),null,{default:b(({tab:o})=>[o.name=="Details"?(s(),f("div",ta,[l.value.sla_status?(s(),d(be,{key:0,modelValue:l.value,"onUpdate:modelValue":e[2]||(e[2]=c=>l.value=c),onUpdateField:B},null,8,["modelValue"])):m("",!0),t(O).data?(s(),f("div",oa,[i(De,{sections:t(O).data,doctype:"CRM Lead",docname:k.leadId,onReload:t(O).reload,onAfterFieldChange:N},null,8,["sections","docname","onReload"])])):m("",!0)])):(s(),d(ye,{key:1,doctype:"CRM Lead",docname:k.leadId,tabs:$.value,reload:z.value,"onUpdate:reload":e[3]||(e[3]=c=>z.value=c),tabIndex:t(g),"onUpdate:tabIndex":e[4]||(e[4]=c=>Y(g)?g.value=c:null),onBeforeSave:ue,onAfterSave:N},null,8,["docname","tabs","reload","tabIndex"]))]),_:1})]),_:1},8,["modelValue","tabs"])])):M.value?(s(),d(ce,{key:2,errorTitle:M.value,errorMessage:T.value},null,8,["errorTitle","errorMessage"])):m("",!0),i(x,{modelValue:R.value,"onUpdate:modelValue":e[10]||(e[10]=o=>R.value=o),options:{title:a.__("Convert to Deal"),size:"xl",actions:[{label:a.__("Convert"),variant:"solid",onClick:ie}]}},{"body-content":b(()=>[r("div",sa,[i(Ve,{class:"h-4 w-4"}),r("label",la,w(a.__("Organization")),1)]),r("div",na,[r("div",ia,[r("div",null,w(a.__("Choose Existing")),1),i(t(H),{modelValue:h.value,"onUpdate:modelValue":e[6]||(e[6]=o=>h.value=o)},null,8,["modelValue"])]),h.value?(s(),d(F,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:_.value,doctype:"CRM Organization",onChange:e[7]||(e[7]=o=>_.value=o)},null,8,["value"])):(s(),f("div",ra,w(a.__("New organization will be created based on the data in details section")),1))]),r("div",ua,[i(Le,{class:"h-4 w-4"}),r("label",da,w(a.__("Contact")),1)]),r("div",ca,[r("div",ma,[r("div",null,w(a.__("Choose Existing")),1),i(t(H),{modelValue:C.value,"onUpdate:modelValue":e[8]||(e[8]=o=>C.value=o)},null,8,["modelValue"])]),C.value?(s(),d(F,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:p.value,doctype:"Contact",onChange:e[9]||(e[9]=o=>p.value=o)},null,8,["value"])):(s(),f("div",va,w(a.__("New contact will be created based on the person's details")),1))])]),_:1},8,["modelValue","options"]),D.value?(s(),d(de,{key:3,modelValue:D.value,"onUpdate:modelValue":e[11]||(e[11]=o=>D.value=o),doctype:"CRM Lead",docname:k.leadId,name:"Leads"},null,8,["modelValue","docname"])):m("",!0)],64)}}};export{lt as default};
//# sourceMappingURL=MobileLead-59b6b029.js.map

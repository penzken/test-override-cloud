import{F as B}from"./FieldLayout-707d1564.js";import{E as D}from"./EditIcon-1993ceb2.js";import{_ as N,O as Q,a0 as A,aM as O,P,m as M,Y as S,a as q,H as k,e as y,f as m,g as p,w as F,d as l,t as R,u as i,C as v,b as E,aS as T,aV as U}from"./index-f67ab40e.js";import{i as z}from"./DragVerticalIcon-08f5f238.js";import{u as H,s as L,a as Y,c as $,q as G}from"./modals-c90d3242.js";const J={class:"bg-surface-modal px-4 pb-6 pt-5 sm:px-6"},K={class:"mb-5 flex items-center justify-between"},W={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},X={class:"flex items-center gap-1"},Z={class:"px-4 pb-7 pt-4 sm:px-6"},ee={class:"space-y-2"},ae={__name:"ContactModal",props:Q({contact:{type:Object,default:{}},options:{type:Object,default:{redirect:!0,afterInsert:()=>{}}}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(b){const c=b,{isManager:w}=A(),x=O(),r=P(b,"modelValue"),_=M(!1),u=M(null),{document:a,triggerOnBeforeCreate:f}=H("Contact");async function V(){_.value=!0,u.value=null,a.doc.email_id&&(a.doc.email_ids=[{email_id:a.doc.email_id,is_primary:1}],delete a.doc.email_id),a.doc.mobile_no&&(a.doc.phone_nos=[{phone:a.doc.mobile_no,is_primary_mobile_no:1}],delete a.doc.mobile_no),await(f==null?void 0:f());const e=await T("frappe.client.insert",{doc:{doctype:"Contact",...a.doc}},{onError:t=>{var o,d;u.value=(d=(o=t.error)==null?void 0:o.messages)==null?void 0:d[0],_.value=!1}});e.name&&(U("contact_created"),I(e))}function I(e){var t,o;(o=(t=c.contact)==null?void 0:t.reload)==null||o.call(t),e.name&&c.options.redirect&&x.push({name:"Contact",params:{contactId:e.name}}),r.value=!1,c.options.afterInsert&&c.options.afterInsert(e)}const g=S({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["QuickEntry","Contact"],params:{doctype:"Contact",type:"Quick Entry"},auto:!0,transform:e=>e.forEach(t=>{t.sections.forEach(o=>{o.columns.forEach(d=>{d.fields.forEach(s=>{s.fieldname=="email_id"||s.fieldname=="mobile_no"?s.read_only=!1:s.fieldname=="address"?(s.create=(n,h)=>{a.doc.address=n,C(),h()},s.edit=n=>C(n)):s.fieldtype==="Table"&&(a.doc[s.fieldname]=[])})})})})});q(()=>{a.doc={},Object.assign(a.doc,c.contact.data||c.contact)});function j(){$.value=!0,G.value={doctype:"Contact"},k(()=>r.value=!1)}function C(e){L.value=!0,Y.value={doctype:"Address",address:e},k(()=>r.value=!1)}return(e,t)=>{const o=y("Button"),d=y("ErrorMessage"),s=y("Dialog");return m(),p(s,{modelValue:r.value,"onUpdate:modelValue":t[1]||(t[1]=n=>r.value=n),options:{size:"xl"}},{body:F(()=>{var n;return[l("div",J,[l("div",K,[l("div",null,[l("h3",W,R(e.__("New Contact")),1)]),l("div",X,[i(w)()&&!i(z)?(m(),p(o,{key:0,variant:"ghost",class:"w-7",tooltip:e.__("Edit fields layout"),icon:D,onClick:j},null,8,["tooltip"])):v("",!0),E(o,{variant:"ghost",class:"w-7",onClick:t[0]||(t[0]=h=>r.value=!1),icon:"x"})])]),(n=i(g).data)!=null&&n.length?(m(),p(B,{key:0,tabs:i(g).data,data:i(a).doc,doctype:"Contact"},null,8,["tabs","data"])):v("",!0),u.value?(m(),p(d,{key:1,class:"mt-8",message:e.__(u.value)},null,8,["message"])):v("",!0)]),l("div",Z,[l("div",ee,[E(o,{class:"w-full",variant:"solid",label:e.__("Create"),loading:_.value,onClick:V},null,8,["label","loading"])])])]}),_:1},8,["modelValue"])}}},ce=N(ae,[["__scopeId","data-v-4b8b7c64"]]);export{ce as C};
//# sourceMappingURL=ContactModal-5febb737.js.map

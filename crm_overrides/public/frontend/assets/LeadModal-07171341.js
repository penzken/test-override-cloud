import{E as B}from"./EditIcon-127a74cc.js";import{F as D}from"./FieldLayout-baadb8ff.js";import{O as I,a2 as Q,a0 as q,P as F,aM as z,m as h,z as P,Y as M,a as T,e as _,f as d,g as c,w as U,d as n,t as A,u as r,C as v,b as w,aV as H,H as W}from"./index-a6920b9f.js";import{s as Y}from"./statuses-57fa655e.js";import{i as $}from"./DragVerticalIcon-3e35903f.js";import{u as G,c as J,q as K}from"./modals-47f1cf8a.js";import{u as X}from"./helpCenter-a7e44f6b.js";const Z={class:"bg-surface-modal px-4 pb-6 pt-5 sm:px-6"},ee={class:"mb-5 flex items-center justify-between"},ae={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},se={class:"flex items-center gap-1"},te={class:"px-4 pb-7 pt-4 sm:px-6"},oe={class:"flex flex-row-reverse gap-2"},me={__name:"LeadModal",props:I({defaults:Object},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(b){const E=b,{user:k}=Q(),{getUser:x,isManager:C}=q(),{getLeadStatus:L,statusOptions:S}=Y(),{updateOnboardingStep:V}=X("frappecrm"),u=F(b,"modelValue"),N=z(),s=h(null),i=h(!1),{document:e,triggerOnBeforeCreate:m}=G("CRM Lead"),f=P(()=>{var t;let a=S("lead");return e.doc.status||(e.doc.status=(t=a==null?void 0:a[0])==null?void 0:t.value),a}),g=M({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["QuickEntry","CRM Lead"],params:{doctype:"CRM Lead",type:"Quick Entry"},auto:!0,transform:a=>a.forEach(t=>{t.sections.forEach(o=>{o.columns.forEach(p=>{p.fields.forEach(l=>{l.fieldname=="status"&&(l.fieldtype="Select",l.options=f.value,l.prefix=L(e.doc.status).color),l.fieldtype==="Table"&&(e.doc[l.fieldname]=[])})})})})}),R=M({url:"frappe.client.insert"});async function O(){e.doc.website&&!e.doc.website.startsWith("http")&&(e.doc.website="https://"+e.doc.website),await(m==null?void 0:m()),R.submit({doc:{doctype:"CRM Lead",...e.doc}},{validate(){if(s.value=null,!e.doc.first_name)return s.value=__("First Name is mandatory"),s.value;if(e.doc.annual_revenue){if(typeof e.doc.annual_revenue=="string")e.doc.annual_revenue=e.doc.annual_revenue.replace(/,/g,"");else if(isNaN(e.doc.annual_revenue))return s.value=__("Annual Revenue should be a number"),s.value}if(e.doc.mobile_no&&isNaN(e.doc.mobile_no.replace(/[-+() ]/g,"")))return s.value=__("Mobile No should be a number"),s.value;if(e.doc.email&&!e.doc.email.includes("@"))return s.value=__("Invalid Email"),s.value;if(!e.doc.status)return s.value=__("Status is required"),s.value;i.value=!0},onSuccess(a){H("lead_created"),i.value=!1,u.value=!1,N.push({name:"Lead",params:{leadId:a.name}}),V("create_first_lead",!0,!1,()=>{localStorage.setItem("firstLead"+k,a.name)})},onError(a){if(i.value=!1,!a.messages){s.value=a.message;return}s.value=a.messages.join(`
`)}})}function j(){J.value=!0,K.value={doctype:"CRM Lead"},W(()=>u.value=!1)}return T(()=>{var a,t,o;e.doc={no_of_employees:"1-10"},Object.assign(e.doc,E.defaults),(a=e.doc)!=null&&a.lead_owner||(e.doc.lead_owner=x().name),!((t=e.doc)!=null&&t.status)&&((o=f.value[0])!=null&&o.value)&&(e.doc.status=f.value[0].value)}),(a,t)=>{const o=_("Button"),p=_("ErrorMessage"),l=_("Dialog");return d(),c(l,{modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=y=>u.value=y),options:{size:"3xl"}},{body:U(()=>[n("div",Z,[n("div",ee,[n("div",null,[n("h3",ae,A(a.__("Create Lead")),1)]),n("div",se,[r(C)()&&!r($)?(d(),c(o,{key:0,variant:"ghost",class:"w-7",tooltip:a.__("Edit fields layout"),icon:B,onClick:j},null,8,["tooltip"])):v("",!0),w(o,{variant:"ghost",class:"w-7",onClick:t[0]||(t[0]=y=>u.value=!1),icon:"x"})])]),n("div",null,[r(g).data?(d(),c(D,{key:0,tabs:r(g).data,data:r(e).doc},null,8,["tabs","data"])):v("",!0),s.value?(d(),c(p,{key:1,class:"mt-4",message:a.__(s.value)},null,8,["message"])):v("",!0)])]),n("div",te,[n("div",oe,[w(o,{variant:"solid",label:a.__("Create"),loading:i.value,onClick:O},null,8,["label","loading"])])])]),_:1},8,["modelValue"])}}};export{me as _};
//# sourceMappingURL=LeadModal-07171341.js.map

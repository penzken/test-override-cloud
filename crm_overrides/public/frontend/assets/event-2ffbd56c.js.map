{"version":3,"file":"event-2ffbd56c.js","sources":["../../../../frontend/src/components/Calendar/Attendee.vue","../../../../frontend/src/components/Calendar/utils.js","../../../../frontend/src/composables/event.js"],"sourcesContent":["<template>\n  <div>\n    <!-- Combobox Input -->\n    <div class=\"flex items-center w-full text-ink-gray-8 [&>div]:w-full\">\n      <ComboboxRoot\n        :model-value=\"tempSelection\"\n        :open=\"showOptions\"\n        @update:open=\"(o) => (showOptions = o)\"\n        @update:modelValue=\"onSelect\"\n        :ignore-filter=\"true\"\n      >\n        <ComboboxAnchor\n          class=\"flex w-full text-base items-center gap-1 rounded border border-outline-gray-2 bg-surface-white hover:border-outline-gray-3 focus:border-outline-gray-4 focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3 px-2 py-1\"\n          :class=\"[size === 'sm' ? 'h-7' : 'h-8 ', inputClass]\"\n          @click=\"showOptions = true\"\n        >\n          <ComboboxInput\n            ref=\"search\"\n            autocomplete=\"off\"\n            class=\"bg-transparent p-0 outline-none border-0 text-base text-ink-gray-8 h-full placeholder:text-ink-gray-4 w-full focus:outline-none focus:ring-0 focus:border-0\"\n            :placeholder=\"placeholder\"\n            :value=\"query\"\n            @input=\"onInput\"\n            @keydown.enter.prevent=\"handleEnter\"\n            @keydown.escape.stop=\"showOptions = false\"\n          />\n          <FeatherIcon\n            name=\"chevron-down\"\n            class=\"h-4 text-ink-gray-5 cursor-pointer\"\n            @click.stop=\"showOptions = !showOptions\"\n          />\n        </ComboboxAnchor>\n        <ComboboxPortal>\n          <ComboboxContent\n            class=\"z-10 mt-1 min-w-48 w-full max-w-md bg-surface-modal overflow-hidden rounded-lg shadow-2xl ring-1 ring-black ring-opacity-5\"\n            position=\"popper\"\n            :align=\"'start'\"\n            @openAutoFocus.prevent\n            @closeAutoFocus.prevent\n          >\n            <ComboboxViewport class=\"max-h-60 overflow-auto p-1.5\">\n              <ComboboxEmpty\n                class=\"flex gap-2 rounded px-2 py-1 text-base text-ink-gray-5\"\n              >\n                <FeatherIcon v-if=\"fetchContacts\" name=\"search\" class=\"h-4\" />\n                {{ emptyStateText }}\n              </ComboboxEmpty>\n              <ComboboxItem\n                v-for=\"option in options\"\n                :key=\"option.value\"\n                :value=\"option.value\"\n                class=\"text-base leading-none text-ink-gray-7 rounded flex items-center px-2 py-1 relative select-none data-[highlighted]:outline-none data-[highlighted]:bg-surface-gray-3 cursor-pointer\"\n                @mousedown.prevent=\"onSelect(option.value, option)\"\n              >\n                <UserAvatar class=\"mr-2\" :user=\"option.value\" size=\"lg\" />\n                <div class=\"flex flex-col gap-1 p-1 text-ink-gray-8\">\n                  <div class=\"text-base font-medium\">{{ option.label }}</div>\n                  <div class=\"text-sm text-ink-gray-5\">{{ option.value }}</div>\n                </div>\n              </ComboboxItem>\n            </ComboboxViewport>\n          </ComboboxContent>\n        </ComboboxPortal>\n      </ComboboxRoot>\n    </div>\n\n    <!-- Selected Attendees -->\n    <div\n      v-if=\"values.length\"\n      class=\"flex flex-col gap-2 mt-2 max-h-[165px] overflow-y-auto\"\n      ref=\"optionsRef\"\n    >\n      <Button\n        ref=\"emails\"\n        v-for=\"att in values\"\n        :key=\"att.email\"\n        :label=\"att.email\"\n        theme=\"gray\"\n        class=\"rounded-full w-fit\"\n        :tooltip=\"getTooltip(att.email)\"\n      >\n        <template #prefix>\n          <UserAvatar :user=\"att.email\" class=\"-ml-1 !size-5.5\" />\n        </template>\n        <template #suffix>\n          <FeatherIcon\n            class=\"h-3.5\"\n            name=\"x\"\n            @click.stop=\"removeValue(att.email)\"\n          />\n        </template>\n      </Button>\n      <ErrorMessage class=\"mt-2 pl-2\" v-if=\"error\" :message=\"error\" />\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport UserAvatar from '@/components/UserAvatar.vue'\nimport { createResource } from 'frappe-ui'\nimport {\n  ComboboxRoot,\n  ComboboxAnchor,\n  ComboboxInput,\n  ComboboxPortal,\n  ComboboxContent,\n  ComboboxViewport,\n  ComboboxItem,\n  ComboboxEmpty,\n} from 'reka-ui'\nimport { ref, computed, nextTick } from 'vue'\nimport { watchDebounced } from '@vueuse/core'\n\nconst props = defineProps({\n  validate: {\n    type: Function,\n    default: null,\n  },\n  variant: {\n    type: String,\n    default: 'subtle',\n  },\n  size: {\n    type: String,\n    default: 'sm',\n  },\n  placeholder: {\n    type: String,\n    default: 'Add attendee',\n  },\n  inputClass: {\n    type: String,\n    default: '',\n  },\n  errorMessage: {\n    type: Function,\n    default: (value) => `${value} is an Invalid value`,\n  },\n  fetchContacts: {\n    type: Boolean,\n    default: true,\n  },\n  existingEmails: {\n    type: Array,\n    default: () => [],\n  },\n})\n\nconst values = defineModel()\n\nconst emails = ref([])\nconst search = ref(null)\nconst error = ref(null)\nconst info = ref(null)\nconst query = ref('')\nconst text = ref('')\nconst showOptions = ref(false)\nconst optionsRef = ref(null)\nconst tempSelection = ref(null)\n\nconst metaByEmail = computed(() => {\n  const out = {}\n  const source = values.value || []\n  for (const a of source) {\n    if (a?.email) out[a.email] = a\n  }\n  return out\n})\n\nfunction getTooltip(email) {\n  const m = metaByEmail.value[email]\n  if (!m) return email\n  const parts = []\n  if (m.reference_doctype) parts.push(m.reference_doctype)\n  if (m.reference_docname) parts.push(m.reference_docname)\n  return parts.length ? parts.join(': ') : email\n}\n\nwatchDebounced(\n  query,\n  (val) => {\n    val = val || ''\n    if (text.value === val && options.value?.length) return\n    text.value = val\n    reload(val)\n  },\n  { debounce: 300, immediate: true },\n)\n\nconst filterOptions = createResource({\n  url: 'crm.api.contact.search_emails',\n  method: 'POST',\n  cache: [text.value, 'Contact'],\n  params: { txt: text.value },\n  transform: (data) => {\n    let allData = data.map((option) => {\n      let fullName = option[0]\n      let email = option[1]\n      let name = option[2]\n      return {\n        label: fullName || name || email,\n        name: name,\n        value: email,\n      }\n    })\n\n    // Filter out existing emails\n    if (props.existingEmails?.length) {\n      allData = allData.filter((option) => {\n        return !props.existingEmails.includes(option.value)\n      })\n    }\n\n    return allData\n  },\n})\n\nconst options = computed(() => {\n  let searchedContacts = props.fetchContacts ? filterOptions.data : []\n  if (!searchedContacts?.length && query.value) {\n    searchedContacts.push({\n      name: 'new',\n      label: query.value,\n      value: query.value,\n    })\n  }\n  return searchedContacts || []\n})\n\nconst emptyStateText = computed(() =>\n  props.fetchContacts\n    ? __('No results found')\n    : __('Type an email address to add attendee'),\n)\n\nfunction reload(val) {\n  if (!props.fetchContacts) return\n\n  filterOptions.update({\n    params: { txt: val },\n  })\n  filterOptions.reload()\n}\n\nfunction onSelect(val, fullOption = null) {\n  if (!val) return\n  const optionObj = fullOption ||\n    options.value.find((o) => o.value === val) || {\n      name: 'new',\n      label: val,\n      value: val,\n    }\n  addValue(optionObj)\n  if (!error.value) {\n    query.value = ''\n    tempSelection.value = null\n    showOptions.value = false\n    nextTick(() => setFocus())\n  }\n}\n\nfunction handleEnter() {\n  if (query.value) {\n    onSelect(query.value, {\n      name: 'new',\n      label: query.value,\n      value: query.value,\n    })\n  }\n}\n\nfunction onInput(e) {\n  query.value = e.target.value\n  showOptions.value = true\n}\n\nconst addValue = (option) => {\n  // Safeguard for falsy option\n  if (!option || !option.value) return\n\n  error.value = null\n  info.value = null\n\n  const current = Array.isArray(values.value) ? values.value.slice() : []\n  const existing = new Set(current.map((a) => a.email))\n\n  const raw = option.value || ''\n  const parts = raw.split(',')\n  const hasMultiple = parts.length > 1\n\n  for (let p of parts) {\n    p = p.trim()\n    if (!p) continue\n    if (existing.has(p)) {\n      info.value = __('email already exists')\n      continue\n    }\n    if (props.validate && !props.validate(p)) {\n      error.value = props.errorMessage(p)\n      query.value = p\n      continue\n    }\n    existing.add(p)\n    const entry = { email: p }\n\n    if (option.name && !hasMultiple) {\n      entry.reference_docname = option.name\n    }\n    current.push(entry)\n  }\n\n  values.value = current\n  // Scroll to the bottom so the last added value is visible\n  nextTick(() => {\n    // use requestAnimationFrame to ensure DOM paint\n    requestAnimationFrame(() => {\n      const el = optionsRef.value\n      if (el) {\n        el.scrollTo({ top: el.scrollHeight, behavior: 'smooth' })\n      }\n    })\n  })\n}\n\nconst removeValue = (email) => {\n  values.value = (values.value || []).filter((a) => a.email !== email)\n}\n\nfunction setFocus() {\n  search.value?.focus?.()\n}\n\ndefineExpose({ setFocus })\n</script>\n","export function allTimeSlots() {\n  const out = []\n  for (let h = 0; h < 24; h++) {\n    for (const m of [0, 15, 30, 45]) {\n      const hh = String(h).padStart(2, '0')\n      const mm = String(m).padStart(2, '0')\n      const ampm = h >= 12 ? 'pm' : 'am'\n      const hour12 = h % 12 === 0 ? 12 : h % 12\n      out.push({\n        value: `${hh}:${mm}`,\n        label: `${hour12}:${mm} ${ampm}`,\n      })\n    }\n  }\n  return out\n}\n","import { usersStore } from '@/stores/users'\r\nimport { dayjs, createListResource } from 'frappe-ui'\r\nimport { computed, ref } from 'vue'\r\nimport { allTimeSlots } from '@/components/Calendar/utils'\r\n\r\nexport const showEventModal = ref(false)\r\nexport const activeEvent = ref(null)\r\n\r\nfunction sameArrayContents(a, b) {\r\n  if (a === b) return true\r\n  if (!Array.isArray(a) || !Array.isArray(b)) return false\r\n  if (a.length !== b.length) return false\r\n  if (a.length === 0) return true\r\n\r\n  const counts = new Map()\r\n  for (const value of a) {\r\n    counts.set(value, (counts.get(value) || 0) + 1)\r\n  }\r\n  for (const value of b) {\r\n    const existing = counts.get(value)\r\n    if (!existing) return false\r\n    if (existing === 1) {\r\n      counts.delete(value)\r\n    } else {\r\n      counts.set(value, existing - 1)\r\n    }\r\n  }\r\n  return counts.size === 0\r\n}\r\n\r\nexport function useEvent(doctype, docname) {\r\n  const { getUser } = usersStore()\r\n\r\n  const eventsResource = createListResource({\r\n    doctype: 'Event',\r\n    cache: ['calendar', docname],\r\n    fields: [\r\n      'name',\r\n      'status',\r\n      'subject',\r\n      'description',\r\n      'starts_on',\r\n      'ends_on',\r\n      'all_day',\r\n      'event_type',\r\n      'color',\r\n      'owner',\r\n      'reference_doctype',\r\n      'reference_docname',\r\n      'creation',\r\n    ],\r\n    filters: {\r\n      reference_doctype: doctype,\r\n      reference_docname: docname,\r\n    },\r\n    auto: true,\r\n    orderBy: 'creation desc',\r\n    onSuccess: (d) => {\r\n      console.log(d)\r\n    },\r\n  })\r\n\r\n  const eventParticipantsResource = createListResource({\r\n    doctype: 'Event Participants',\r\n    fields: ['*'],\r\n    parent: 'Event',\r\n  })\r\n\r\n  const events = computed(() => {\r\n    if (!eventsResource.data) return []\r\n    const eventNames = eventsResource.data.map((e) => e.name)\r\n    if (\r\n      !eventParticipantsResource.data?.length ||\r\n      eventsParticipantIsUpdated(eventNames)\r\n    ) {\r\n      eventParticipantsResource.update({\r\n        filters: {\r\n          parenttype: 'Event',\r\n          parentfield: 'event_participants',\r\n          parent: ['in', eventNames],\r\n        },\r\n      })\r\n      !eventParticipantsResource.list.loading &&\r\n        eventParticipantsResource.reload()\r\n    } else {\r\n      eventsResource.data.forEach((event) => {\r\n        if (typeof event.owner !== 'object') {\r\n          event.owner = {\r\n            label: getUser(event.owner).full_name,\r\n            image: getUser(event.owner).user_image,\r\n            name: event.owner,\r\n          }\r\n        }\r\n\r\n        event.event_participants = [\r\n          ...eventParticipantsResource.data.filter(\r\n            (participant) => participant.parent === event.name,\r\n          ),\r\n        ]\r\n\r\n        event.participants = [\r\n          event.owner,\r\n          ...eventParticipantsResource.data\r\n            .filter((participant) => participant.parent === event.name)\r\n            .map((participant) => ({\r\n              label: getUser(participant.email).full_name || participant.email,\r\n              image: getUser(participant.email).user_image || '',\r\n              name: participant.email,\r\n            })),\r\n        ]\r\n      })\r\n    }\r\n\r\n    return eventsResource.data\r\n  })\r\n\r\n  function eventsParticipantIsUpdated(eventNames) {\r\n    const parentFilter = eventParticipantsResource.filters?.parent?.[1]\r\n\r\n    if (eventNames.length && !sameArrayContents(parentFilter, eventNames))\r\n      return true\r\n\r\n    let d = eventsResource.setValue.data\r\n    if (!d) return false\r\n\r\n    let newParticipants = d.event_participants.map((p) => p.name)\r\n    let oldParticipants = eventParticipantsResource.data\r\n      .filter((p) => p.parent === d.name)\r\n      .map((p) => p.name)\r\n\r\n    return !sameArrayContents(newParticipants, oldParticipants)\r\n  }\r\n\r\n  const startEndTime = (\r\n    startTime,\r\n    endTime,\r\n    isFullDay = false,\r\n    format = 'h:mm a',\r\n  ) => {\r\n    const start = dayjs(startTime)\r\n    const end = dayjs(endTime)\r\n\r\n    if (isFullDay) return __('All day')\r\n\r\n    return `${start.format(format)} - ${end.format(format)}`\r\n  }\r\n\r\n  const startDate = (startTime, format = 'ddd, D MMM YYYY') => {\r\n    const start = dayjs(startTime)\r\n    return start.format(format)\r\n  }\r\n\r\n  return {\r\n    eventsResource,\r\n    eventParticipantsResource,\r\n    events,\r\n    startEndTime,\r\n    startDate,\r\n  }\r\n}\r\n\r\nexport function normalizeParticipants(list = []) {\r\n  const seen = new Set()\r\n  const out = []\r\n  for (const a of list || []) {\r\n    if (!a?.email || seen.has(a.email)) continue\r\n    seen.add(a.email)\r\n    out.push({\r\n      email: a.email,\r\n      reference_doctype: a.reference_doctype || 'Contact',\r\n      reference_docname: a.reference_docname || '',\r\n    })\r\n  }\r\n  return out\r\n}\r\n\r\nexport function formatDuration(mins) {\r\n  if (mins < 60) return __('{0} mins', [mins])\r\n  let hours = mins / 60\r\n  if (hours % 1 !== 0 && hours % 1 !== 0.5) {\r\n    hours = hours.toFixed(2)\r\n  }\r\n  if (Number.isInteger(hours)) {\r\n    return hours === 1 ? __('1 hr') : __('{0} hrs', [hours])\r\n  }\r\n  return `${hours} hrs`\r\n}\r\n\r\nexport function buildEndTimeOptions(fromTime) {\r\n  const timeSlots = allTimeSlots()\r\n  if (!fromTime) return timeSlots\r\n  const startIndex = timeSlots.findIndex((o) => o.value > fromTime)\r\n  if (startIndex === -1) return []\r\n  const [fh, fm] = fromTime.split(':').map((n) => parseInt(n))\r\n  const fromTotal = fh * 60 + fm\r\n  return timeSlots.slice(startIndex).map((o) => {\r\n    const [th, tm] = o.value.split(':').map((n) => parseInt(n))\r\n    const toTotal = th * 60 + tm\r\n    const duration = toTotal - fromTotal\r\n    return { ...o, label: `${o.label} (${formatDuration(duration)})` }\r\n  })\r\n}\r\n\r\nexport function computeAutoToTime(fromTime) {\r\n  if (!fromTime) return ''\r\n  const [hour, minute] = fromTime.split(':').map((n) => parseInt(n))\r\n  let nh = hour + 1\r\n  let nm = minute\r\n  if (nh >= 24) {\r\n    nh = 23\r\n    nm = 59\r\n  }\r\n  return `${String(nh).padStart(2, '0')}:${String(nm).padStart(2, '0')}`\r\n}\r\n\r\nexport function validateTimeRange({ fromDate, fromTime, toTime, isFullDay }) {\r\n  if (isFullDay) return { valid: true, error: null }\r\n  if (!fromTime || !toTime) {\r\n    return { valid: false, error: __('Start and end time are required') }\r\n  }\r\n  const start = dayjs(fromDate + ' ' + fromTime)\r\n  const end = dayjs(fromDate + ' ' + toTime)\r\n  if (!start.isValid() || !end.isValid()) {\r\n    return { valid: false, error: __('Invalid start or end time') }\r\n  }\r\n  if (end.diff(start, 'minute') <= 0) {\r\n    return { valid: false, error: __('End time should be after start time') }\r\n  }\r\n  return { valid: true, error: null }\r\n}\r\n\r\nexport function parseEventDoc(doc) {\r\n  if (!doc) return {}\r\n  const { getUser } = usersStore()\r\n  return {\r\n    id: doc.name,\r\n    title: doc.subject,\r\n    description: doc.description,\r\n    status: doc.status,\r\n    fromDate: dayjs(doc.starts_on).format('YYYY-MM-DD'),\r\n    toDate: dayjs(doc.ends_on).format('YYYY-MM-DD'),\r\n    fromTime: dayjs(doc.starts_on).format('HH:mm'),\r\n    toTime: dayjs(doc.ends_on).format('HH:mm'),\r\n    isFullDay: doc.all_day,\r\n    eventType: doc.event_type,\r\n    color: doc.color,\r\n    referenceDoctype: doc.reference_doctype,\r\n    referenceDocname: doc.reference_docname,\r\n    event_participants: doc.event_participants || [],\r\n    owner: doc.owner\r\n      ? {\r\n          label: getUser(doc.owner).full_name,\r\n          image: getUser(doc.owner).user_image,\r\n          value: doc.owner,\r\n        }\r\n      : null,\r\n  }\r\n}\r\n\r\n"],"names":["props","__props","values","_useModel","emails","ref","search","error","info","query","text","showOptions","optionsRef","tempSelection","metaByEmail","computed","out","source","a","getTooltip","email","m","parts","watchDebounced","val","_a","options","reload","filterOptions","createResource","data","allData","option","fullName","name","searchedContacts","emptyStateText","onSelect","fullOption","optionObj","o","addValue","nextTick","setFocus","handleEnter","onInput","e","current","existing","hasMultiple","p","entry","el","removeValue","_b","__expose","_createElementBlock","_createElementVNode","_hoisted_1","_createVNode","_unref","ComboboxRoot","_cache","ComboboxAnchor","_normalizeClass","ComboboxInput","_component_FeatherIcon","_withModifiers","$event","ComboboxPortal","ComboboxContent","ComboboxViewport","ComboboxEmpty","_createBlock","_createTextVNode","_Fragment","_renderList","ComboboxItem","UserAvatar","_hoisted_2","_hoisted_3","_toDisplayString","_hoisted_4","att","_component_Button","_component_ErrorMessage","allTimeSlots","h","hh","mm","ampm","hour12","showEventModal","activeEvent","sameArrayContents","b","counts","value","useEvent","doctype","docname","getUser","usersStore","eventsResource","createListResource","d","eventParticipantsResource","events","eventNames","eventsParticipantIsUpdated","event","participant","parentFilter","newParticipants","oldParticipants","startTime","endTime","isFullDay","format","start","dayjs","end","normalizeParticipants","list","seen","formatDuration","mins","hours","buildEndTimeOptions","fromTime","timeSlots","startIndex","fh","fm","n","fromTotal","th","tm","duration","computeAutoToTime","hour","minute","nh","nm","validateTimeRange","fromDate","toTime","parseEventDoc","doc"],"mappings":"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"}
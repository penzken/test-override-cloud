import{g as ie,S as se}from"./view-d56bbd34.js";import{_ as le}from"./Icon-f8d63d14.js";import{L as re}from"./LayoutHeader-0ab09138.js";import{_ as me}from"./DealsListView-333f8d77.js";import{_ as ce}from"./ContactsListView-161b6272.js";import{D as de}from"./DetailsIcon-18759e5d.js";import{C as ue}from"./CameraIcon-39bf1b22.js";import{D as _e}from"./DealsIcon-97fb4069.js";import{C as ge}from"./ContactsIcon-e88572ff.js";import{u as pe,s as fe,a as ye,d as he,e as be,_ as ve}from"./modals-47f1cf8a.js";import{g as we}from"./settings-97110a1e.js";import{b as F,f as L,t as $,a as ze,D as ke,h as Ce,o as xe}from"./index-8df5241e.js";import{g as De}from"./global-0d0156ec.js";import{a0 as Ie,a1 as Me,aM as Oe,z as _,Y as Re,m as Se,a4 as q,aR as A,c as f,u as t,g as u,w as d,C as r,b as s,F as Be,aS as T,e as w,f as i,d as m,L as Fe,a8 as x,t as z,n as V,aD as j,aT as Le}from"./index-a6920b9f.js";import{s as $e}from"./statuses-57fa655e.js";import{_ as qe}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-7d13eeef.js";import{F as Ae}from"./FileUploader-28868f3a.js";import{u as Te}from"./pageMeta-16e1c7dd.js";import"./EditIcon-127a74cc.js";import"./Link-a0855a11.js";import"./FadedScrollableDiv-6f6cd639.js";import"./ArrowUpRightIcon-992c4380.js";import"./DragVerticalIcon-3e35903f.js";import"./ListBulkActions-aeb61c26.js";import"./DeleteLinkedDocModal-58bed83f.js";import"./ListView-3ebdc383.js";import"./TextEditor.vue_vue_type_script_setup_true_lang-0d82d5b6.js";import"./MultipleAvatar-3dcbfb2e.js";import"./IndicatorIcon-2f30d1a9.js";import"./PhoneIcon-687b9433.js";import"./ListFooter-0e14e4e1.js";import"./TabButtons-4a3dac25.js";import"./description-f82bb340.js";const Ve={class:"relative flex h-10.5 items-center justify-between gap-2 py-2.5 pl-2"},je={key:1,class:"flex flex-col h-full overflow-hidden"},Ne={class:"flex flex-col items-start justify-start gap-4 p-4"},Pe={class:"flex gap-4 items-center"},Ee={class:"group relative h-14.5 w-14.5"},Ue={class:"z-1 absolute bottom-0 left-0 right-0 flex h-14 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-5 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(22px 0 0 0)","clip-path":"inset(22px 0 0 0)"}},We={class:"flex flex-col gap-2 truncate"},He={class:"truncate text-lg font-medium text-ink-gray-9"},Ye={class:"flex items-center gap-1.5"},Ge={key:0},Je={key:0,class:"flex flex-1 flex-col justify-between overflow-hidden"},Ke={key:3,class:"grid flex-1 place-items-center text-xl font-medium text-ink-gray-4"},Qe={class:"flex flex-col items-center justify-center space-y-3"},Sa={__name:"MobileOrganization",props:{organizationId:{type:String,required:!0}},setup(N){const c=N,{brand:P}=we(),{getUser:D}=Ie(),{$dialog:E}=De(),{getDealStatus:U}=$e(),{doctypeMeta:W}=F("CRM Organization"),g=Me(),H=Oe(),{document:n,permissions:Y}=pe("CRM Organization",c.organizationId),G=_(()=>{var e,a;return((a=(e=Y.data)==null?void 0:e.permissions)==null?void 0:a.delete)||!1}),J=_(()=>{let e=[{label:__("Organizations"),route:{name:"Organizations"}}];if(g.query.view||g.query.viewType){let a=ie(g.query.view,g.query.viewType,"CRM Organization");a&&e.push({label:__(a.label),icon:a.icon,route:{name:"Organizations",params:{viewType:g.query.viewType},query:{view:g.query.view}}})}return e.push({label:I.value,route:{name:"Organization",params:{organizationId:c.organizationId}}}),e}),I=_(()=>{var a,l;let e=((a=W["CRM Organization"])==null?void 0:a.title_field)||"name";return((l=n.doc)==null?void 0:l[e])||c.organizationId});Te(()=>({title:I.value,icon:P.favicon}));async function M(e){await T("frappe.client.set_value",{doctype:"CRM Organization",name:c.organizationId,fieldname:"organization_logo",value:(e==null?void 0:e.file_url)||""}),n.reload()}async function K(){E({title:__("Delete organization"),message:__("Are you sure you want to delete this organization?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",async onClick(e){await T("frappe.client.delete",{doctype:"CRM Organization",name:c.organizationId}),e(),H.push({name:"Organizations"})}}]})}function Q(){if(!n.doc.website){Le.error(__("No website found"));return}xe(n.doc.website)}const k=Re({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections",cache:["sidePanelSections","CRM Organization"],params:{doctype:"CRM Organization"},auto:!0,transform:e=>X(e)});function X(e){return e.map(a=>(a.columns=a.columns.map(l=>(l.fields=l.fields.map(p=>p.fieldname==="address"?{...p,create:(b,C)=>{B(),C()},edit:b=>B(b)}:p),l)),a))}const y=Se(0),Z=[{name:"Details",label:__("Details"),icon:de},{name:"Deals",label:__("Deals"),icon:q(_e,{class:"h-4 w-4"}),count:_(()=>{var e;return(e=O.data)==null?void 0:e.length})},{name:"Contacts",label:__("Contacts"),icon:q(ge,{class:"h-4 w-4"}),count:_(()=>{var e;return(e=R.data)==null?void 0:e.length})}],O=A({type:"list",doctype:"CRM Deal",cache:["deals",c.organizationId],fields:["name","organization","currency","annual_revenue","status","email","mobile_no","deal_owner","modified"],filters:{organization:c.organizationId},orderBy:"modified desc",pageLength:20,auto:!0}),R=A({type:"list",doctype:"Contact",cache:["contacts",c.organizationId],fields:["name","full_name","image","email_id","mobile_no","company_name","modified"],filters:{company_name:c.organizationId},orderBy:"modified desc",pageLength:20,auto:!0}),h=_(()=>{let e=[];return e=y.value?R:O,e.data?e.data.map(a=>y.value?oe(a):ae(a)):[]}),{getFormattedCurrency:ee}=F("CRM Deal"),S=_(()=>y.value===0?te:ne);function ae(e){var a,l;return{name:e.name,organization:{label:e.organization,logo:(a=n.doc)==null?void 0:a.organization_logo},annual_revenue:ee("annual_revenue",e),status:{label:e.status,color:(l=U(e.status))==null?void 0:l.color},email:e.email,mobile_no:e.mobile_no,deal_owner:{label:e.deal_owner&&D(e.deal_owner).full_name,...e.deal_owner&&D(e.deal_owner)},modified:{label:L(e.modified),timeAgo:__($(e.modified))}}}function oe(e){var a;return{name:e.name,full_name:{label:e.full_name,image_label:e.full_name,image:e.image},email:e.email_id,mobile_no:e.mobile_no,company_name:{label:e.company_name,logo:(a=n.doc)==null?void 0:a.organization_logo},modified:{label:L(e.modified),timeAgo:__($(e.modified))}}}const te=[{label:__("Organization"),key:"organization",width:"11rem"},{label:__("Amount"),key:"annual_revenue",align:"right",width:"9rem"},{label:__("Status"),key:"status",width:"10rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Mobile no"),key:"mobile_no",width:"11rem"},{label:__("Deal owner"),key:"deal_owner",width:"10rem"},{label:__("Last modified"),key:"modified",width:"8rem"}],ne=[{label:__("Name"),key:"full_name",width:"17rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Phone"),key:"mobile_no",width:"12rem"},{label:__("Organization"),key:"company_name",width:"12rem"},{label:__("Last modified"),key:"modified",width:"8rem"}];function B(e){fe.value=!0,ye.value={doctype:"Address",address:e}}return(e,a)=>{const l=w("FeatherIcon"),p=w("Button"),b=w("ErrorMessage"),C=w("Badge");return i(),f(Be,null,[t(n).doc?(i(),u(re,{key:0},{default:d(()=>[m("header",Ve,[s(t(qe),{items:J.value},{prefix:d(({item:o})=>[o.icon?(i(),u(le,{key:0,icon:o.icon,class:"mr-2 h-4"},null,8,["icon"])):r("",!0)]),_:1},8,["items"])])]),_:1})):r("",!0),t(n).doc?(i(),f("div",je,[s(t(Ae),{onSuccess:M,validateFile:t(Ce)},{default:d(({openFileSelector:o,error:v})=>[m("div",Ne,[m("div",Pe,[m("div",Ee,[s(t(ze),{size:"3xl",class:"h-14.5 w-14.5",label:t(n).doc.organization_name,image:t(n).doc.organization_logo},null,8,["label","image"]),(i(),u(x(t(n).doc.organization_logo?t(ke):"div"),Fe(t(n).doc.organization_logo?{options:[{icon:"upload",label:t(n).doc.organization_logo?e.__("Change image"):e.__("Upload image"),onClick:o},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>M("")}]}:{onClick:o},{class:"!absolute bottom-0 left-0 right-0"}),{default:d(()=>[m("div",Ue,[s(ue,{class:"h-6 w-6 cursor-pointer text-white"})])]),_:1},16))]),m("div",We,[m("div",He,z(t(n).doc.name),1),m("div",Ye,[s(p,{onClick:Q},{default:d(()=>[s(l,{name:"link",class:"h-4 w-4"})]),_:1}),G.value?(i(),u(p,{key:0,label:e.__("Delete"),theme:"red",size:"sm",iconLeft:"trash-2",onClick:K},null,8,["label"])):r("",!0)]),s(b,{message:e.__(v)},null,8,["message"])])])])]),_:1},8,["validateFile"]),s(t(ve),{as:"div",modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=o=>y.value=o),tabs:Z,class:"overflow-auto"},{default:d(()=>[s(t(he),{class:"!px-4"},{default:d(({tab:o,selected:v})=>[o.name!=="Details"?(i(),f("button",{key:0,class:V(["group flex items-center gap-2 border-b border-transparent py-2.5 text-base text-ink-gray-5 duration-300 ease-in-out hover:border-outline-gray-3 hover:text-ink-gray-9",{"text-ink-gray-9":v}])},[o.icon?(i(),u(x(o.icon),{key:0,class:"h-5"})):r("",!0),j(" "+z(e.__(o.label))+" ",1),s(C,{class:V(["group-hover:bg-surface-gray-7",[v?"bg-surface-gray-7":"bg-gray-600"]]),variant:"solid",theme:"gray",size:"sm"},{default:d(()=>[j(z(o.count),1)]),_:2},1032,["class"])],2)):r("",!0)]),_:1}),s(t(be),null,{default:d(({tab:o})=>[o.name=="Details"?(i(),f("div",Ge,[t(k).data?(i(),f("div",Je,[s(se,{sections:t(k).data,doctype:"CRM Organization",docname:t(n).doc.name,onReload:t(k).reload},null,8,["sections","docname","onReload"])])):r("",!0)])):r("",!0),o.label==="Deals"&&h.value.length?(i(),u(me,{key:1,class:"mt-4",rows:h.value,columns:S.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):r("",!0),o.label==="Contacts"&&h.value.length?(i(),u(ce,{key:2,class:"mt-4",rows:h.value,columns:S.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):r("",!0),!h.value.length&&o.name!=="Details"?(i(),f("div",Ke,[m("div",Qe,[(i(),u(x(o.icon),{class:"!h-10 !w-10"})),m("div",null,z(e.__("No {0} Found",[e.__(o.label)])),1)])])):r("",!0)]),_:1})]),_:1},8,["modelValue"])])):r("",!0)],64)}}};export{Sa as default};
//# sourceMappingURL=MobileOrganization-19b3e565.js.map

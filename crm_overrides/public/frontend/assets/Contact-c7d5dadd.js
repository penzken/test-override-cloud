import{a as fe}from"./DeleteLinkedDocModal-e4436c61.js";import{_ as ge}from"./ErrorPage-1f5c00c0.js";import{_ as ye}from"./Resizer-0ecb2706.js";import{_ as ve}from"./Icon-139ad12b.js";import{g as he,S as be}from"./view-7ff77848.js";import{L as we}from"./LayoutHeader-5b7dc4bc.js";import{P as Ce}from"./PhoneIcon-ac6fd96c.js";import{C as ke}from"./CameraIcon-4b6cbbe3.js";import{D as xe}from"./DealsIcon-dd22e0bf.js";import{_ as De}from"./DealsListView-b30cdd67.js";import{_ as ze}from"./CustomActions-b50b52ca.js";import{b as U,f as Se,t as Me,s as Ie,a as H,D as $e,h as Ve}from"./index-2d43ee63.js";import{u as Te,s as Pe,a as Re,_ as Fe}from"./modals-c90d3242.js";import{g as Le}from"./settings-73cd67d9.js";import{g as qe}from"./global-56e80edc.js";import{a0 as Ae,a1 as Be,aM as Ne,m as S,z as f,a4 as Ee,Y,aS as k,aT as g,A as je,c as h,u as s,g as d,w as u,C as r,b as _,F as Oe,e as I,f as l,d as c,a8 as $,L as Ue,t as b,aD as G,n as J}from"./index-f67ab40e.js";import{o as He}from"./organizations-1e471901.js";import{s as Ye}from"./statuses-56a48e3b.js";import{c as K}from"./DragVerticalIcon-08f5f238.js";import{_ as Ge}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-c38bfcf2.js";import{F as Je}from"./FileUploader-18585c97.js";import{u as Ke}from"./pageMeta-1053637e.js";import"./ListView-55f30f20.js";import"./EditIcon-1993ceb2.js";import"./Link-ecdb2b5a.js";import"./FadedScrollableDiv-93770c12.js";import"./ArrowUpRightIcon-1efa1a5e.js";import"./ListBulkActions-f5bf0f4b.js";import"./TextEditor.vue_vue_type_script_setup_true_lang-1676428f.js";import"./MultipleAvatar-341cbdb7.js";import"./IndicatorIcon-2666baa3.js";import"./ListFooter-11a8e70a.js";import"./TabButtons-cbd39dfe.js";import"./description-6eb9f930.js";const Qe={key:1,ref:"parentRef",class:"flex h-full"},We={class:"border-b"},Xe={class:"flex flex-col items-start justify-start gap-4 p-5"},Ze={class:"flex gap-4 items-center"},ea={class:"group relative h-15.5 w-15.5"},aa={class:"z-1 absolute bottom-0 left-0 right-0 flex h-14 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-5 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(22px 0 0 0)","clip-path":"inset(22px 0 0 0)"}},ta={class:"flex flex-col gap-2 truncate text-ink-gray-9"},oa={class:"truncate text-2xl font-medium"},sa={key:0},na={key:0,class:"flex items-center gap-1.5 text-base text-ink-gray-8"},la={class:""},ia={class:"flex gap-1.5"},ra={key:0,class:"flex flex-1 flex-col justify-between overflow-hidden"},ca={key:1,class:"grid flex-1 place-items-center text-xl font-medium text-ink-gray-4"},ma={class:"flex flex-col items-center justify-center space-y-3"},Ha={__name:"Contact",props:{contactId:{type:String,required:!0}},setup(Q){const{brand:W}=Le(),{makeCall:X,$dialog:Z,$socket:ee}=qe(),{getUser:V}=Ae(),{getOrganization:T}=He(),{getDealStatus:ae}=Ye(),{doctypeMeta:te}=U("Contact"),w=Q,y=Be(),oe=Ne(),P=S(""),se=S(""),{document:a,permissions:ne,scripts:R}=Te("Contact",w.contactId),le=f(()=>{var e,o;return((o=(e=ne.data)==null?void 0:e.permissions)==null?void 0:o.delete)||!1}),ie=f(()=>{let e=[{label:__("Contacts"),route:{name:"Contacts"}}];if(y.query.view||y.query.viewType){let o=he(y.query.view,y.query.viewType,"Contact");o&&e.push({label:__(o.label),icon:o.icon,route:{name:"Contacts",params:{viewType:y.query.viewType},query:{view:y.query.view}}})}return e.push({label:F.value,route:{name:"Contact",params:{contactId:w.contactId}}}),e}),F=f(()=>{var o,n;let e=((o=te.Contact)==null?void 0:o.title_field)||"name";return((n=a.doc)==null?void 0:n[e])||w.contactId});Ke(()=>({title:F.value,icon:W.favicon}));const x=S(!1);async function L(){x.value=!0}function q(e){a.doc.image=(e==null?void 0:e.file_url)||"",a.save.submit(null,{onSuccess:()=>{g.success(__("Contact image updated"))}})}const A=S(0),re=[{label:"Deals",icon:Ee(xe,{class:"h-4 w-4"}),count:f(()=>{var e;return(e=D.data)==null?void 0:e.length})}],D=Y({url:"crm.api.contact.get_linked_deals",cache:["deals",w.contactId],params:{contact:w.contactId},auto:!0}),M=f(()=>!D.data||D.data==[]?[]:D.data.map(e=>ue(e))),z=Y({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections",cache:["sidePanelSections","Contact"],params:{doctype:"Contact"},auto:!0}),ce=f(()=>z.data?z.data.map(e=>({...e,columns:e.columns.map(o=>({...o,fields:o.fields.map(n=>{var p,C;return n.fieldname==="email_id"?{...n,read_only:!1,fieldtype:"Dropdown",options:(((p=a.doc)==null?void 0:p.email_ids)||[]).map(i=>({name:i.name,value:i.email_id,selected:i.email_id===a.doc.email_id,placeholder:"john@doe.com",onClick:()=>B("email",i.email_id),onSave:(t,m)=>m?N("email",t.value):E("Contact Email",t.name,"email_id",t.value),onDelete:async(t,m)=>{a.doc.email_ids=a.doc.email_ids.filter(v=>v.name!==t.name),m||await j("Contact Email",t.name)}})),create:()=>{a.doc.email_ids=[...a.doc.email_ids||[],{name:"new-1",value:"",selected:!1,isNew:!0}]}}:n.fieldname==="mobile_no"?{...n,read_only:!1,fieldtype:"Dropdown",options:(((C=a.doc)==null?void 0:C.phone_nos)||[]).map(i=>({name:i.name,value:i.phone,selected:i.phone===a.doc.mobile_no,onClick:()=>B("mobile_no",i.phone),onSave:(t,m)=>m?N("phone",t.value):E("Contact Phone",t.name,"phone",t.value),onDelete:async(t,m)=>{a.doc.phone_nos=a.doc.phone_nos.filter(v=>v.name!==t.name),m||await j("Contact Phone",t.name)}})),create:()=>{a.doc.phone_nos=[...a.doc.phone_nos||[],{name:"new-1",value:"",selected:!1,isNew:!0}]}}:n.fieldname==="address"?{...n,create:(i,t)=>{O(),t&&t()},edit:i=>O(i)}:n})}))})):[]);async function B(e,o){await k("crm.api.contact.set_as_primary",{contact:a.doc.name,field:e,value:o})&&(a.reload(),g.success(__("Contact updated")))}async function N(e,o){if(!o)return;await k("crm.api.contact.create_new",{contact:a.doc.name,field:e,value:o})&&(a.reload(),g.success(__("Contact updated")))}async function E(e,o,n,p){await k("frappe.client.set_value",{doctype:e,name:o,fieldname:n,value:p})&&(a.reload(),g.success(__("Contact updated")))}async function j(e,o){await k("frappe.client.delete",{doctype:e,name:o}),await a.reload(),g.success(__("Contact updated"))}const{getFormattedCurrency:me}=U("CRM Deal"),de=f(()=>_e);function ue(e){var o,n;return{name:e.name,organization:{label:e.organization,logo:(o=T(e.organization))==null?void 0:o.organization_logo},annual_revenue:me("annual_revenue",e),status:{label:e.status,color:(n=ae(e.status))==null?void 0:n.color},email:e.email,mobile_no:e.mobile_no,deal_owner:{label:e.deal_owner&&V(e.deal_owner).full_name,...e.deal_owner&&V(e.deal_owner)},modified:{label:Se(e.modified),timeAgo:__(Me(e.modified))}}}const _e=[{label:__("Organization"),key:"organization",width:"11rem"},{label:__("Amount"),key:"annual_revenue",align:"right",width:"9rem"},{label:__("Status"),key:"status",width:"10rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Mobile no"),key:"mobile_no",width:"11rem"},{label:__("Deal owner"),key:"deal_owner",width:"10rem"},{label:__("Last modified"),key:"modified",width:"8rem"}];function O(e){Pe.value=!0,Re.value={doctype:"Address",address:e}}return je(()=>a.doc,async e=>{var o;if((o=R.data)!=null&&o.length){let n=await Ie(R.data,{doc:e,$dialog:Z,$socket:ee,router:oe,toast:g,updateField:a.setValue.submit,createToast:g.create,deleteDoc:L,call:k});a._actions=n.actions||[]}},{once:!0}),(e,o)=>{const n=I("ErrorMessage"),p=I("Button"),C=I("Badge"),i=fe;return l(),h(Oe,null,[s(a).doc?(l(),d(we,{key:0},{"left-header":u(()=>[_(s(Ge),{items:ie.value},{prefix:u(({item:t})=>[t.icon?(l(),d(ve,{key:0,icon:t.icon,class:"mr-2 h-4"},null,8,["icon"])):r("",!0)]),_:1},8,["items"])]),"right-header":u(()=>{var t;return[(t=s(a)._actions)!=null&&t.length?(l(),d(ze,{key:0,actions:s(a)._actions},null,8,["actions"])):r("",!0)]}),_:1})):r("",!0),s(a).doc?(l(),h("div",Qe,[s(a).doc?(l(),d(ye,{key:0,parent:e.$refs.parentRef,class:"flex h-full flex-col overflow-hidden border-r"},{default:u(()=>[c("div",We,[_(s(Je),{onSuccess:q,validateFile:s(Ve)},{default:u(({openFileSelector:t,error:m})=>{var v;return[c("div",Xe,[c("div",Ze,[c("div",ea,[_(s(H),{size:"3xl",class:"h-15.5 w-15.5",label:s(a).doc.full_name,image:s(a).doc.image},null,8,["label","image"]),(l(),d($(s(a).doc.image?s($e):"div"),Ue(s(a).doc.image?{options:[{icon:"upload",label:s(a).doc.image?e.__("Change image"):e.__("Upload image"),onClick:t},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>q("")}]}:{onClick:t},{class:"!absolute bottom-0 left-0 right-0"}),{default:u(()=>[c("div",aa,[_(ke,{class:"h-6 w-6 cursor-pointer text-white"})])]),_:1},16))]),c("div",ta,[c("div",oa,[s(a).doc.salutation?(l(),h("span",sa,b(s(a).doc.salutation+". "),1)):r("",!0),c("span",null,b(s(a).doc.full_name),1)]),s(a).doc.company_name?(l(),h("div",na,[_(s(H),{size:"xs",label:s(a).doc.company_name,image:(v=s(T)(s(a).doc.company_name))==null?void 0:v.organization_logo},null,8,["label","image"]),c("span",la,b(s(a).doc.company_name),1)])):r("",!0),_(n,{message:e.__(m)},null,8,["message"])])]),c("div",ia,[s(K)&&s(a).doc.mobile_no?(l(),d(p,{key:0,label:e.__("Make Call"),size:"sm",iconLeft:Ce,onClick:o[0]||(o[0]=pe=>s(K)&&s(X)(s(a).doc.mobile_no))},null,8,["label"])):r("",!0),le.value?(l(),d(p,{key:1,label:e.__("Delete"),theme:"red",size:"sm",iconLeft:"trash-2",onClick:o[1]||(o[1]=pe=>L())},null,8,["label"])):r("",!0)])])]}),_:1},8,["validateFile"])]),s(z).data?(l(),h("div",ra,[_(be,{sections:ce.value,doctype:"Contact",docname:s(a).doc.name,onReload:s(z).reload},null,8,["sections","docname","onReload"])])):r("",!0)]),_:1},8,["parent"])):r("",!0),_(s(Fe),{as:"div",modelValue:A.value,"onUpdate:modelValue":o[2]||(o[2]=t=>A.value=t),tabs:re},{"tab-item":u(({tab:t,selected:m})=>[c("button",{class:J(["group flex items-center gap-2 border-b border-transparent py-2.5 text-base text-ink-gray-5 duration-300 ease-in-out hover:border-outline-gray-3 hover:text-ink-gray-9",{"text-ink-gray-9":m}])},[t.icon?(l(),d($(t.icon),{key:0,class:"h-5"})):r("",!0),G(" "+b(e.__(t.label))+" ",1),_(C,{class:J(["group-hover:bg-surface-gray-7",[m?"bg-surface-gray-7":"bg-gray-600"]]),variant:"solid",theme:"gray",size:"sm"},{default:u(()=>[G(b(t.count),1)]),_:2},1032,["class"])],2)]),"tab-panel":u(({tab:t})=>[t.label==="Deals"&&M.value.length?(l(),d(De,{key:0,class:"mt-4",rows:M.value,columns:de.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):r("",!0),M.value.length?r("",!0):(l(),h("div",ca,[c("div",ma,[(l(),d($(t.icon),{class:"!h-10 !w-10"})),c("div",null,b(e.__("No {0} Found",[e.__(t.label)])),1)])]))]),_:1},8,["modelValue"])],512)):P.value?(l(),d(ge,{key:2,errorTitle:P.value,errorMessage:se.value},null,8,["errorTitle","errorMessage"])):r("",!0),x.value?(l(),d(i,{key:3,modelValue:x.value,"onUpdate:modelValue":o[3]||(o[3]=t=>x.value=t),doctype:"Contact",docname:s(a).doc.name,name:"Contacts"},null,8,["modelValue","docname"])):r("",!0)],64)}}};export{Ha as default};
//# sourceMappingURL=Contact-c7d5dadd.js.map

import{_ as _e}from"./ErrorPage-f1ea6704.js";import{_ as ge}from"./Resizer-850b6a12.js";import{g as pe,S as fe}from"./view-d56bbd34.js";import{_ as be}from"./Icon-f8d63d14.js";import{L as ye}from"./LayoutHeader-0ab09138.js";import{_ as he}from"./DealsListView-333f8d77.js";import{_ as ve}from"./ContactsListView-161b6272.js";import{_ as Ce,f as i,c as f,d as s,a0 as we,a1 as ze,aM as ke,m as z,z as _,Y as xe,a4 as A,aR as N,A as Me,u as n,g as c,w as u,C as l,b as d,F as Oe,aT as x,aS as Z,e as M,a8 as O,L as Re,t as h,aD as j,n as E}from"./index-a6920b9f.js";import{C as De}from"./CameraIcon-39bf1b22.js";import{D as Ie}from"./DealsIcon-97fb4069.js";import{C as $e}from"./ContactsIcon-e88572ff.js";import{a as Ve}from"./DeleteLinkedDocModal-58bed83f.js";import{_ as Se}from"./CustomActions-faabd076.js";import{u as Be,s as Te,a as Fe,_ as Le}from"./modals-47f1cf8a.js";import{g as qe}from"./settings-97110a1e.js";import{g as Pe}from"./global-0d0156ec.js";import{b as U,f as W,t as H,s as Ae,a as Ne,D as Ze,h as je,o as Ee}from"./index-8df5241e.js";import{s as Ue}from"./statuses-57fa655e.js";import{_ as We}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-7d13eeef.js";import{F as He}from"./FileUploader-28868f3a.js";import{u as Ye}from"./pageMeta-16e1c7dd.js";import"./EditIcon-127a74cc.js";import"./Link-a0855a11.js";import"./FadedScrollableDiv-6f6cd639.js";import"./ArrowUpRightIcon-992c4380.js";import"./DragVerticalIcon-3e35903f.js";import"./ListBulkActions-aeb61c26.js";import"./TextEditor.vue_vue_type_script_setup_true_lang-0d82d5b6.js";import"./MultipleAvatar-3dcbfb2e.js";import"./IndicatorIcon-2f30d1a9.js";import"./PhoneIcon-687b9433.js";import"./ListView-3ebdc383.js";import"./ListFooter-0e14e4e1.js";import"./TabButtons-4a3dac25.js";import"./description-f82bb340.js";const Ge={},Je={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Ke(R,m){return i(),f("svg",Je,[...m[0]||(m[0]=[s("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M2.02062 7.49896C2.49506 7.49716 2.97742 7.4933 3.47006 7.48935C3.94277 7.48556 4.42495 7.48169 4.9187 7.47951C4.97589 6.3862 5.14998 5.23014 5.51484 4.17085C5.76241 3.45208 6.1023 2.76557 6.56226 2.17336C4.09972 2.77895 2.23508 4.90491 2.02062 7.49896ZM8 2.1204C7.29452 2.69277 6.79592 3.52219 6.46032 4.49652C6.13931 5.4285 5.97681 6.46734 5.92025 7.4779C6.5896 7.47899 7.28127 7.485 8 7.49989C8.7546 7.48425 9.43077 7.47841 10.0797 7.47777C10.0232 6.46725 9.86068 5.42846 9.53968 4.49651C9.20408 3.52219 8.70548 2.69277 8 2.1204ZM10.0822 8.47771C10.0279 9.50221 9.8654 10.5578 9.53968 11.5035C9.20409 12.4778 8.70548 13.3072 8.00001 13.8796C7.29453 13.3072 6.79592 12.4778 6.46032 11.5035C6.13462 10.5579 5.9721 9.5023 5.91784 8.47784C6.58355 8.47892 7.27164 8.48494 7.98959 8.49989C7.99653 8.50004 8.00347 8.50004 8.01042 8.49989C8.76493 8.48417 9.43715 8.47833 10.0822 8.47771ZM4.91661 8.47951C4.43411 8.48168 3.962 8.48548 3.49714 8.48922C2.99784 8.49323 2.50691 8.49718 2.02045 8.49899C2.2341 11.094 4.09907 13.2209 6.56227 13.8266C6.1023 13.2344 5.76241 12.5479 5.51484 11.8291C5.14541 10.7566 4.97157 9.58487 4.91661 8.47951ZM9.43774 13.8266C9.89771 13.2344 10.2376 12.5479 10.4852 11.8291C10.8545 10.7569 11.0283 9.58549 11.0834 8.48039C11.4269 8.48234 11.771 8.48511 12.1244 8.48796C12.7045 8.49264 13.3098 8.49752 13.9795 8.4993C13.7658 11.0941 11.9008 13.2209 9.43774 13.8266ZM13.9794 7.49928C13.3241 7.49751 12.7264 7.49271 12.1508 7.48809C11.7885 7.48518 11.435 7.48234 11.0814 7.48037C11.0242 6.38681 10.8501 5.23042 10.4852 4.17085C10.2376 3.45208 9.89771 2.76557 9.43774 2.17336C11.9004 2.77897 13.7651 4.90509 13.9794 7.49928ZM1 8C1 4.13401 4.13401 1 8 1C11.866 1 15 4.13401 15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8Z",fill:"currentColor"},null,-1)])])}const Qe=Ce(Ge,[["render",Ke]]),Xe={key:1,ref:"parentRef",class:"flex h-full"},ea={class:"border-b"},aa={class:"flex flex-col items-start justify-start gap-4 p-5"},oa={class:"flex gap-4 items-center"},ta={class:"group relative h-15.5 w-15.5"},na={class:"z-1 absolute bottom-0 left-0 right-0 flex h-14 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-5 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(22px 0 0 0)","clip-path":"inset(22px 0 0 0)"}},ia={class:"flex flex-col gap-2 truncate"},sa={class:"truncate text-2xl font-medium text-ink-gray-9"},ra={key:0,class:"flex items-center gap-1.5 text-base text-ink-gray-8"},la={class:"flex gap-1.5"},ma={key:0,class:"flex flex-1 flex-col justify-between overflow-hidden"},ca={key:2,class:"grid flex-1 place-items-center text-xl font-medium text-ink-gray-4"},da={class:"flex flex-col items-center justify-center space-y-3"},Ya={__name:"Organization",props:{organizationId:{type:String,required:!0}},setup(R){const m=R,{brand:Y}=qe(),{$dialog:G,$socket:J}=Pe(),{getUser:D}=we(),{getDealStatus:K}=Ue(),{doctypeMeta:Q}=U("CRM Organization"),g=ze(),I=ke(),$=z(""),X=z(""),v=z(!1),{document:o,permissions:ee,scripts:V}=Be("CRM Organization",m.organizationId),ae=_(()=>{var e,a;return((a=(e=ee.data)==null?void 0:e.permissions)==null?void 0:a.delete)||!1}),oe=_(()=>{let e=[{label:__("Organizations"),route:{name:"Organizations"}}];if(g.query.view||g.query.viewType){let a=pe(g.query.view,g.query.viewType,"CRM Organization");a&&e.push({label:__(a.label),icon:a.icon,route:{name:"Organizations",params:{viewType:g.query.viewType},query:{view:g.query.view}}})}return e.push({label:S.value,route:{name:"Organization",params:{organizationId:m.organizationId}}}),e}),S=_(()=>{var a,r;let e=((a=Q["CRM Organization"])==null?void 0:a.title_field)||"name";return((r=o.doc)==null?void 0:r[e])||m.organizationId});Ye(()=>({title:S.value,icon:Y.favicon}));async function B(){v.value=!0}function T(e){o.setValue.submit({organization_logo:(e==null?void 0:e.file_url)||null})}function te(e){e!=null&&e.hasOwnProperty("organization_name")?Z("frappe.client.rename_doc",{doctype:"CRM Organization",old_name:m.organizationId,new_name:e.organization_name}).then(()=>{I.push({name:"Organization",params:{organizationId:e.organization_name}})}):o.save.submit()}function ne(e){return e&&e.replace(/^(?:https?:\/\/)?(?:www\.)?/i,"")}function ie(){if(!o.doc.website){x.error(__("No website found"));return}Ee(o.doc.website)}const k=xe({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections",cache:["sidePanelSections","CRM Organization"],params:{doctype:"CRM Organization"},auto:!0,transform:e=>se(e)});function se(e){return e.map(a=>(a.columns=a.columns.map(r=>(r.fields=r.fields.map(p=>p.fieldname==="address"?{...p,create:(C,t)=>{P(),t()},edit:C=>P(C)}:p),r)),a))}const b=z(0),re=[{label:"Deals",icon:A(Ie,{class:"h-4 w-4"}),count:_(()=>{var e;return(e=F.data)==null?void 0:e.length})},{label:"Contacts",icon:A($e,{class:"h-4 w-4"}),count:_(()=>{var e;return(e=L.data)==null?void 0:e.length})}],F=N({type:"list",doctype:"CRM Deal",cache:["deals",m.organizationId],fields:["name","organization","currency","deal_value","status","email","mobile_no","deal_owner","modified"],filters:{organization:m.organizationId},orderBy:"modified desc",pageLength:20,auto:!0}),L=N({type:"list",doctype:"Contact",cache:["contacts",m.organizationId],fields:["name","full_name","image","email_id","mobile_no","company_name","modified"],filters:{company_name:m.organizationId},orderBy:"modified desc",pageLength:20,auto:!0}),y=_(()=>{let e=[];return e=b.value?L:F,e.data?e.data.map(a=>b.value?ce(a):me(a)):[]}),{getFormattedCurrency:le}=U("CRM Deal"),q=_(()=>b.value===0?de:ue);function me(e){var a,r;return{name:e.name,organization:{label:e.organization,logo:(a=o.doc)==null?void 0:a.organization_logo},deal_value:le("deal_value",e),status:{label:e.status,color:(r=K(e.status))==null?void 0:r.color},email:e.email,mobile_no:e.mobile_no,deal_owner:{label:e.deal_owner&&D(e.deal_owner).full_name,...e.deal_owner&&D(e.deal_owner)},modified:{label:W(e.modified),timeAgo:__(H(e.modified))}}}function ce(e){var a;return{name:e.name,full_name:{label:e.full_name,image_label:e.full_name,image:e.image},email:e.email_id,mobile_no:e.mobile_no,company_name:{label:e.company_name,logo:(a=o.doc)==null?void 0:a.organization_logo},modified:{label:W(e.modified),timeAgo:__(H(e.modified))}}}const de=[{label:__("Organization"),key:"organization",width:"11rem"},{label:__("Deal Value"),key:"deal_value",align:"right",width:"9rem"},{label:__("Status"),key:"status",width:"10rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Mobile no"),key:"mobile_no",width:"11rem"},{label:__("Deal owner"),key:"deal_owner",width:"10rem"},{label:__("Last modified"),key:"modified",width:"8rem"}],ue=[{label:__("Name"),key:"full_name",width:"17rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Phone"),key:"mobile_no",width:"12rem"},{label:__("Organization"),key:"company_name",width:"12rem"},{label:__("Last modified"),key:"modified",width:"8rem"}];function P(e){Te.value=!0,Fe.value={doctype:"Address",address:e}}return Me(()=>o.doc,async e=>{var a;if((a=V.data)!=null&&a.length){let r=await Ae(V.data,{doc:e,$dialog:G,$socket:J,router:I,toast:x,updateField:o.setValue.submit,createToast:x.create,deleteDoc:B,call:Z});o._actions=r.actions||[]}},{once:!0}),(e,a)=>{const r=M("ErrorMessage"),p=M("Button"),C=M("Badge");return i(),f(Oe,null,[n(o).doc?(i(),c(ye,{key:0},{"left-header":u(()=>[d(n(We),{items:oe.value},{prefix:u(({item:t})=>[t.icon?(i(),c(be,{key:0,icon:t.icon,class:"mr-2 h-4"},null,8,["icon"])):l("",!0)]),_:1},8,["items"])]),"right-header":u(()=>{var t;return[(t=n(o)._actions)!=null&&t.length?(i(),c(Se,{key:0,actions:n(o)._actions},null,8,["actions"])):l("",!0)]}),_:1})):l("",!0),n(o).doc?(i(),f("div",Xe,[n(o).doc?(i(),c(ge,{key:0,parent:e.$refs.parentRef,class:"flex h-full flex-col overflow-hidden border-r"},{default:u(()=>[s("div",ea,[d(n(He),{onSuccess:T,validateFile:n(je)},{default:u(({openFileSelector:t,error:w})=>[s("div",aa,[s("div",oa,[s("div",ta,[d(n(Ne),{size:"3xl",class:"h-15.5 w-15.5",label:n(o).doc.organization_name,image:n(o).doc.organization_logo},null,8,["label","image"]),(i(),c(O(n(o).doc.organization_logo?n(Ze):"div"),Re(n(o).doc.organization_logo?{options:[{icon:"upload",label:n(o).doc.organization_logo?e.__("Change image"):e.__("Upload image"),onClick:t},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>T("")}]}:{onClick:t},{class:"!absolute bottom-0 left-0 right-0"}),{default:u(()=>[s("div",na,[d(De,{class:"h-6 w-6 cursor-pointer text-white"})])]),_:1},16))]),s("div",ia,[s("div",sa,[s("span",null,h(n(o).doc.name),1)]),n(o).doc.website?(i(),f("div",ra,[d(Qe,{class:"size-4"}),s("span",null,h(ne(n(o).doc.website)),1)])):l("",!0),d(r,{message:e.__(w)},null,8,["message"])])]),s("div",la,[ae.value?(i(),c(p,{key:0,label:e.__("Delete"),theme:"red",size:"sm",iconLeft:"trash-2",onClick:a[0]||(a[0]=ua=>B())},null,8,["label"])):l("",!0),d(p,{tooltip:e.__("Open website"),icon:"link",onClick:ie},null,8,["tooltip"])])])]),_:1},8,["validateFile"])]),n(k).data?(i(),f("div",ma,[d(fe,{sections:n(k).data,doctype:"CRM Organization",docname:n(o).doc.name,onReload:n(k).reload,onBeforeFieldChange:te},null,8,["sections","docname","onReload"])])):l("",!0)]),_:1},8,["parent"])):l("",!0),d(n(Le),{as:"div",modelValue:b.value,"onUpdate:modelValue":a[1]||(a[1]=t=>b.value=t),tabs:re},{"tab-item":u(({tab:t,selected:w})=>[s("button",{class:E(["group flex items-center gap-2 border-b border-transparent py-2.5 text-base text-ink-gray-5 duration-300 ease-in-out hover:border-outline-gray-3 hover:text-ink-gray-9",{"text-ink-gray-9":w}])},[t.icon?(i(),c(O(t.icon),{key:0,class:"h-5"})):l("",!0),j(" "+h(e.__(t.label))+" ",1),d(C,{class:E(["group-hover:bg-surface-gray-7",[w?"bg-surface-gray-7":"bg-gray-600"]]),variant:"solid",theme:"gray",size:"sm"},{default:u(()=>[j(h(t.count),1)]),_:2},1032,["class"])],2)]),"tab-panel":u(({tab:t})=>[t.label==="Deals"&&y.value.length?(i(),c(he,{key:0,class:"mt-4",rows:y.value,columns:q.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):l("",!0),t.label==="Contacts"&&y.value.length?(i(),c(ve,{key:1,class:"mt-4",rows:y.value,columns:q.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):l("",!0),y.value.length?l("",!0):(i(),f("div",ca,[s("div",da,[(i(),c(O(t.icon),{class:"!h-10 !w-10"})),s("div",null,h(e.__("No {0} Found",[e.__(t.label)])),1)])]))]),_:1},8,["modelValue"])],512)):$.value?(i(),c(_e,{key:2,errorTitle:$.value,errorMessage:X.value},null,8,["errorTitle","errorMessage"])):l("",!0),v.value?(i(),c(Ve,{key:3,modelValue:v.value,"onUpdate:modelValue":a[2]||(a[2]=t=>v.value=t),doctype:"CRM Organization",docname:m.organizationId,name:"Organizations"},null,8,["modelValue","docname"])):l("",!0)],64)}}};export{Ya as default};
//# sourceMappingURL=Organization-4e6baac2.js.map

import{m as S,a as W,x as xe,bp as P,j as Y,a4 as oe,bt as Re,br as we,z as D,bn as Q,J as de,A as _e,bk as te,bu as Ee,F as ce,bj as Ce,aF as Ie,k as ae,bN as he,bG as se,bv as F,bz as re,bF as Me,bw as Fe,bx as H,by as B,H as pe,f as k,g as j,w as R,c as E,r as Se,u as A,B as M,L as J,d as V,n as z,a8 as Be,C as K,aD as $e,t as fe,O as Ne,P as je,b as q,T as ie,U as ue,e as ke,M as Pe,N as De,cp as Le,a5 as Ve,a6 as ze,a7 as qe,aU as Ke,$ as Ge,aO as ge,a3 as me,W as Ue,cy as He,aP as We,l as Ae,aR as Ye,aT as L,b$ as Je,aS as Qe,aN as Ze,Y as be}from"./index-a6920b9f.js";import{g as Oe}from"./global-0d0156ec.js";import{b as le,N as Xe,O as et,P as tt}from"./index-8df5241e.js";import{s as at,a as nt}from"./DragVerticalIcon-3e35903f.js";function ye(e,t){if(e)return e;let s=t??"button";if(typeof s=="string"&&s.toLowerCase()==="button")return"button"}function rt(e,t){let s=S(ye(e.value.type,e.value.as));return W(()=>{s.value=ye(e.value.type,e.value.as)}),xe(()=>{var u;s.value||P(t)&&P(t)instanceof HTMLButtonElement&&!((u=P(t))!=null&&u.hasAttribute("type"))&&(s.value="button")}),s}let st=Y({props:{onFocus:{type:Function,required:!0}},setup(e){let t=S(!0);return()=>t.value?oe(we,{as:"button",type:"button",features:Re.Focusable,onFocus(s){s.preventDefault();let u,v=50;function l(){var c;if(v--<=0){u&&cancelAnimationFrame(u);return}if((c=e.onFocus)!=null&&c.call(e)){t.value=!1,cancelAnimationFrame(u);return}u=requestAnimationFrame(l)}u=requestAnimationFrame(l)}}):null}});var lt=(e=>(e[e.Forwards=0]="Forwards",e[e.Backwards=1]="Backwards",e))(lt||{}),ot=(e=>(e[e.Less=-1]="Less",e[e.Equal=0]="Equal",e[e.Greater=1]="Greater",e))(ot||{});let Te=Symbol("TabsContext");function ne(e){let t=ae(Te,null);if(t===null){let s=new Error(`<${e} /> is missing a parent <TabGroup /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(s,ne),s}return t}let ve=Symbol("TabsSSRContext"),it=Y({name:"TabGroup",emits:{change:e=>!0},props:{as:{type:[Object,String],default:"template"},selectedIndex:{type:[Number],default:null},defaultIndex:{type:[Number],default:0},vertical:{type:[Boolean],default:!1},manual:{type:[Boolean],default:!1}},inheritAttrs:!1,setup(e,{slots:t,attrs:s,emit:u}){var v;let l=S((v=e.selectedIndex)!=null?v:e.defaultIndex),c=S([]),o=S([]),y=D(()=>e.selectedIndex!==null),C=D(()=>y.value?e.selectedIndex:l.value);function b(r){var f;let i=Q(a.tabs.value,P),d=Q(a.panels.value,P),_=i.filter($=>{var I;return!((I=P($))!=null&&I.hasAttribute("disabled"))});if(r<0||r>i.length-1){let $=se(l.value===null?0:Math.sign(r-l.value),{[-1]:()=>1,0:()=>se(Math.sign(r),{[-1]:()=>0,0:()=>0,1:()=>1}),1:()=>0}),I=se($,{0:()=>i.indexOf(_[0]),1:()=>i.indexOf(_[_.length-1])});I!==-1&&(l.value=I),a.tabs.value=i,a.panels.value=d}else{let $=i.slice(0,r),I=[...i.slice(r),...$].find(m=>_.includes(m));if(!I)return;let n=(f=i.indexOf(I))!=null?f:a.selectedIndex.value;n===-1&&(n=a.selectedIndex.value),l.value=n,a.tabs.value=i,a.panels.value=d}}let a={selectedIndex:D(()=>{var r,f;return(f=(r=l.value)!=null?r:e.defaultIndex)!=null?f:null}),orientation:D(()=>e.vertical?"vertical":"horizontal"),activation:D(()=>e.manual?"manual":"auto"),tabs:c,panels:o,setSelectedIndex(r){C.value!==r&&u("change",r),y.value||b(r)},registerTab(r){var f;if(c.value.includes(r))return;let i=c.value[l.value];if(c.value.push(r),c.value=Q(c.value,P),!y.value){let d=(f=c.value.indexOf(i))!=null?f:l.value;d!==-1&&(l.value=d)}},unregisterTab(r){let f=c.value.indexOf(r);f!==-1&&c.value.splice(f,1)},registerPanel(r){o.value.includes(r)||(o.value.push(r),o.value=Q(o.value,P))},unregisterPanel(r){let f=o.value.indexOf(r);f!==-1&&o.value.splice(f,1)}};de(Te,a);let h=S({tabs:[],panels:[]}),x=S(!1);W(()=>{x.value=!0}),de(ve,D(()=>x.value?null:h.value));let w=D(()=>e.selectedIndex);return W(()=>{_e([w],()=>{var r;return b((r=e.selectedIndex)!=null?r:e.defaultIndex)},{immediate:!0})}),xe(()=>{if(!y.value||C.value==null||a.tabs.value.length<=0)return;let r=Q(a.tabs.value,P);r.some((f,i)=>P(a.tabs.value[i])!==P(f))&&a.setSelectedIndex(r.findIndex(f=>P(f)===P(a.tabs.value[C.value])))}),()=>{let r={selectedIndex:l.value};return oe(ce,[c.value.length<=0&&oe(st,{onFocus:()=>{for(let f of c.value){let i=P(f);if((i==null?void 0:i.tabIndex)===0)return i.focus(),!0}return!1}}),te({theirProps:{...s,...Ee(e,["selectedIndex","defaultIndex","manual","vertical","onChange"])},ourProps:{},slot:r,slots:t,attrs:s,name:"TabGroup"})])}}}),ut=Y({name:"TabList",props:{as:{type:[Object,String],default:"div"}},setup(e,{attrs:t,slots:s}){let u=ne("TabList");return()=>{let v={selectedIndex:u.selectedIndex.value},l={role:"tablist","aria-orientation":u.orientation.value};return te({ourProps:l,theirProps:e,slot:v,attrs:t,slots:s,name:"TabList"})}}}),ct=Y({name:"Tab",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1},id:{type:String,default:null}},setup(e,{attrs:t,slots:s,expose:u}){var v;let l=(v=e.id)!=null?v:`headlessui-tabs-tab-${Ce()}`,c=ne("Tab"),o=S(null);u({el:o,$el:o}),W(()=>c.registerTab(o)),Ie(()=>c.unregisterTab(o));let y=ae(ve),C=D(()=>{if(y.value){let d=y.value.tabs.indexOf(l);return d===-1?y.value.tabs.push(l)-1:d}return-1}),b=D(()=>{let d=c.tabs.value.indexOf(o);return d===-1?C.value:d}),a=D(()=>b.value===c.selectedIndex.value);function h(d){var _;let $=d();if($===re.Success&&c.activation.value==="auto"){let I=(_=Fe(o))==null?void 0:_.activeElement,n=c.tabs.value.findIndex(m=>P(m)===I);n!==-1&&c.setSelectedIndex(n)}return $}function x(d){let _=c.tabs.value.map($=>P($)).filter(Boolean);if(d.key===F.Space||d.key===F.Enter){d.preventDefault(),d.stopPropagation(),c.setSelectedIndex(b.value);return}switch(d.key){case F.Home:case F.PageUp:return d.preventDefault(),d.stopPropagation(),h(()=>H(_,B.First));case F.End:case F.PageDown:return d.preventDefault(),d.stopPropagation(),h(()=>H(_,B.Last))}if(h(()=>se(c.orientation.value,{vertical(){return d.key===F.ArrowUp?H(_,B.Previous|B.WrapAround):d.key===F.ArrowDown?H(_,B.Next|B.WrapAround):re.Error},horizontal(){return d.key===F.ArrowLeft?H(_,B.Previous|B.WrapAround):d.key===F.ArrowRight?H(_,B.Next|B.WrapAround):re.Error}}))===re.Success)return d.preventDefault()}let w=S(!1);function r(){var d;w.value||(w.value=!0,!e.disabled&&((d=P(o))==null||d.focus({preventScroll:!0}),c.setSelectedIndex(b.value),Me(()=>{w.value=!1})))}function f(d){d.preventDefault()}let i=rt(D(()=>({as:e.as,type:t.type})),o);return()=>{var d,_;let $={selected:a.value,disabled:(d=e.disabled)!=null?d:!1},{...I}=e,n={ref:o,onKeydown:x,onMousedown:f,onClick:r,id:l,role:"tab",type:i.value,"aria-controls":(_=P(c.panels.value[b.value]))==null?void 0:_.id,"aria-selected":a.value,tabIndex:a.value?0:-1,disabled:e.disabled?!0:void 0};return te({ourProps:n,theirProps:I,slot:$,attrs:t,slots:s,name:"Tab"})}}}),ft=Y({name:"TabPanels",props:{as:{type:[Object,String],default:"div"}},setup(e,{slots:t,attrs:s}){let u=ne("TabPanels");return()=>{let v={selectedIndex:u.selectedIndex.value};return te({theirProps:e,ourProps:{},slot:v,attrs:s,slots:t,name:"TabPanels"})}}}),dt=Y({name:"TabPanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:null},tabIndex:{type:Number,default:0}},setup(e,{attrs:t,slots:s,expose:u}){var v;let l=(v=e.id)!=null?v:`headlessui-tabs-panel-${Ce()}`,c=ne("TabPanel"),o=S(null);u({el:o,$el:o}),W(()=>c.registerPanel(o)),Ie(()=>c.unregisterPanel(o));let y=ae(ve),C=D(()=>{if(y.value){let h=y.value.panels.indexOf(l);return h===-1?y.value.panels.push(l)-1:h}return-1}),b=D(()=>{let h=c.panels.value.indexOf(o);return h===-1?C.value:h}),a=D(()=>b.value===c.selectedIndex.value);return()=>{var h;let x={selected:a.value},{tabIndex:w,...r}=e,f={ref:o,id:l,role:"tabpanel","aria-labelledby":(h=P(c.tabs.value[b.value]))==null?void 0:h.id,tabIndex:a.value?w:-1};return!a.value&&e.unmount&&!e.static?oe(we,{as:"span","aria-hidden":!0,...f}):te({ourProps:f,theirProps:r,slot:x,attrs:t,slots:s,features:he.Static|he.RenderStrategy,visible:a.value,name:"TabPanel"})}}});const pt={__name:"TabList",setup(e){const t=ae("tab"),s=S([]),u=S(null),v=D(()=>{var o;return(o=t.value.tabs.value)==null?void 0:o.length}),l=S("");function c(o){o>=v.value&&(o=v.value-1);const y=s.value[o].el;t.value.vertical.value?(u.value.style.height=`${y.offsetHeight}px`,u.value.style.top=`${y.offsetTop}px`):(u.value.style.width=`${y.offsetWidth}px`,u.value.style.left=`${y.offsetLeft}px`)}return _e(()=>t.value.tabIndex.value,o=>{o>=v.value&&(t.value.tabIndex.value=v.value-1),l.value="transition-all duration-300 ease-in-out",pe(()=>c(o))}),W(()=>{pe(()=>c(t.value.tabIndex.value)),setTimeout(()=>c(t.value.tabIndex.value),100)}),(o,y)=>(k(),j(A(ut),{class:z(["relative flex",A(t).vertical?"flex-col border-r overflow-y-auto":"gap-7.5 border-b overflow-x-auto items-center px-5"])},{default:R(()=>[(k(!0),E(ce,null,Se(A(t).tabs,(C,b)=>(k(),j(A(ct),{ref_for:!0,ref_key:"tabRef",ref:s,as:"template",key:b,class:"focus:outline-none focus:transition-none"},{default:R(({selected:a})=>[M(o.$slots,"default",J({ref_for:!0},{tab:C,selected:a}),()=>[V("button",{class:z(["flex items-center gap-1.5 text-base text-ink-gray-5 duration-300 ease-in-out hover:text-ink-gray-9",[a?"text-ink-gray-9":"",A(t).vertical?"py-2.5 px-4 border-r border-transparent hover:border-outline-gray-3":"py-3 border-b border-transparent hover:border-outline-gray-3"]])},[C.icon?(k(),j(Be(C.icon),{key:0,class:"size-4"})):K("",!0),$e(" "+fe(C.label),1)],2)])]),_:2},1024))),128)),V("div",{ref_key:"indicator",ref:u,class:z(["tab-indicator absolute bg-surface-gray-7",[A(t).vertical?"right-0 w-px":"bottom-0 h-px",l.value]])},null,2)]),_:3},8,["class"]))}},vt={__name:"TabPanel",setup(e){const t=ae("tab");return(s,u)=>(k(),j(A(ft),{class:"flex flex-1 overflow-hidden"},{default:R(()=>[(k(!0),E(ce,null,Se(A(t).tabs,(v,l)=>(k(),j(A(dt),{class:"flex flex-1 flex-col overflow-y-auto focus:outline-none",key:l},{default:R(()=>[M(s.$slots,"default",J({ref_for:!0},{tab:v}))]),_:2},1024))),128))]),_:3}))}},Pt={__name:"Tabs",props:Ne({as:{type:String,default:"template"},tabs:{type:Array,required:!0},vertical:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const t=e,s=je(e,"modelValue");return de("tab",D(()=>({tabIndex:s,tabs:t.tabs,vertical:t.vertical}))),(u,v)=>(k(),j(A(it),J(e.as!=="template"?{as:e.as,class:["flex flex-1 overflow-hidden",e.vertical?"":"flex-col "]}:{},{defaultIndex:s.value,selectedIndex:s.value,onChange:v[0]||(v[0]=l=>s.value=l)}),{default:R(()=>[M(u.$slots,"default",{},()=>[q(pt,null,{default:R(({tab:l,selected:c})=>[M(u.$slots,"tab-item",ie(ue({tab:l,selected:c})))]),_:3}),q(vt,null,{default:R(({tab:l})=>[M(u.$slots,"tab-panel",ie(ue({tab:l})))]),_:3})])]),_:3},16,["defaultIndex","selectedIndex"]))}},ht={inheritAttrs:!1},Dt=Object.assign(ht,{__name:"Section",props:{label:{type:String,default:""},hideLabel:{type:Boolean,default:!1},opened:{type:Boolean,default:!0},collapsible:{type:Boolean,default:!0},collapseIconPosition:{type:String,default:"left"},labelClass:{type:[String,Object,Array],default:""},headerClass:{type:[String,Object,Array],default:""}},setup(e){const t=e,s=S(t.hideLabel),u=S(t.opened);function v(){u.value=!u.value}function l(){u.value=!0}function c(){u.value=!1}return(o,y)=>{const C=ke("FeatherIcon");return k(),E("div",null,[M(o.$slots,"header",ie(ue({opened:u.value,hide:s.value,open:l,close:c,toggle:v})),()=>[s.value?K("",!0):(k(),E("div",{key:0,class:z(["section-header flex items-center justify-between",e.headerClass])},[V("div",{class:z(["flex text-ink-gray-9 max-w-fit cursor-pointer items-center gap-2 text-base",e.labelClass]),onClick:y[0]||(y[0]=b=>e.collapsible&&v())},[e.collapsible&&e.collapseIconPosition==="left"?(k(),j(C,{key:0,name:"chevron-right",class:z(["h-4 transition-all duration-300 ease-in-out",{"rotate-90":u.value}])},null,8,["class"])):K("",!0),V("span",null,fe(o.__(e.label)||o.__("Untitled")),1),e.collapsible&&e.collapseIconPosition==="right"?(k(),j(C,{key:1,name:"chevron-right",class:z(["h-4 transition-all duration-300 ease-in-out",{"rotate-90":u.value}])},null,8,["class"])):K("",!0)],2),M(o.$slots,"actions")],2))]),q(Le,{"enter-active-class":"duration-300 ease-in","leave-active-class":"duration-300 ease-[cubic-bezier(0, 1, 0.5, 1)]","enter-to-class":"max-h-[200px] overflow-hidden","leave-from-class":"max-h-[200px] overflow-hidden","enter-from-class":"max-h-0 overflow-hidden","leave-to-class":"max-h-0 overflow-hidden"},{default:R(()=>[Pe(V("div",J({class:"columns"},o.$attrs),[M(o.$slots,"default",ie(ue({opened:u.value,open:l,close:c,toggle:v})))],16),[[De,u.value]])]),_:3})])}}}),gt={key:0},mt={key:1},bt={key:1},yt={key:2},xt={__name:"KeyboardShortcut",props:{meta:Boolean,ctrl:Boolean,shift:Boolean,alt:Boolean,shortcut:String,bg:Boolean},setup(e){const t=navigator.userAgent.includes("Mac");return(s,u)=>(k(),E("div",{class:z(["inline-flex items-center gap-0.5 text-sm",{"bg-surface-gray-2 rounded-sm text-ink-gray-5 py-0.5 px-1":e.bg,"text-ink-gray-4":!e.bg}])},[e.ctrl||e.meta?(k(),E("span",gt,[A(t)?(k(),j(A(Ve),{key:0,class:"w-3 h-3"})):(k(),E("span",mt,"Ctrl"))])):K("",!0),e.shift?(k(),E("span",bt,[q(A(ze),{class:"w-3 h-3"})])):K("",!0),e.alt?(k(),E("span",yt,[q(A(qe),{class:"w-3 h-3"})])):K("",!0),M(s.$slots,"default")],2))}},wt={class:"rounded bg-surface-gray-7 py-1.5 px-2 text-xs text-ink-white shadow-xl"},_t={class:"flex items-center gap-1"},At={__name:"Password",props:{modelValue:{type:[String,Number],default:""},value:{type:[String,Number],default:""}},setup(e){const t=e,s=S(!1),u=D(()=>{let v=t.modelValue||t.value;return!(v!=null&&v.includes("*"))});return(v,l)=>{const c=ke("FeatherIcon");return k(),j(A(Ue),J({type:s.value?"text":"password",value:e.modelValue||e.value},v.$attrs,{onKeydown:[l[1]||(l[1]=ge(me(o=>s.value=!s.value,["meta","prevent"]),["i"])),l[2]||(l[2]=ge(me(o=>s.value=!s.value,["ctrl","prevent"]),["i"]))]}),Ke({suffix:R(()=>[q(A(Ge),null,{body:R(()=>[V("div",wt,[V("span",_t,[$e(fe(s.value?v.__("Hide Password"):v.__("Show Password"))+" ",1),q(xt,{bg:"",ctrl:"",class:"!bg-surface-gray-5 !text-ink-gray-2 px-1"},{default:R(()=>[...l[3]||(l[3]=[V("span",{class:"font-mono leading-none tracking-widest"},"+I",-1)])]),_:1})])])]),default:R(()=>[V("div",null,[Pe(q(c,{name:s.value?"eye-off":"eye",class:"h-3 cursor-pointer mr-1",onClick:l[0]||(l[0]=o=>s.value=!s.value)},null,8,["name"]),[[De,u.value]])])]),_:1})]),_:2},[v.$slots.prefix?{name:"prefix",fn:R(()=>[M(v.$slots,"prefix")]),key:"0"}:void 0]),1040,["type","value"])}}},Ot={__name:"FormattedInput",props:{value:{type:[String,Number],default:""},formattedValue:{type:[String,Number],default:""}},setup(e){const t=e,s=He(),u=S(!1),v=S(null);function l(){u.value=!0,pe(()=>{var y;v.value&&((y=v.value.el)==null||y.select())})}const c=D(()=>u.value?t.value:t.formattedValue||t.value),o=D(()=>[{sm:"text-xs",md:"text-base"}[s.size||"sm"],"text-ink-gray-5"]);return(y,C)=>(k(),E(ce,null,[q(A(We),J({ref_key:"inputRef",ref:v,value:c.value,onFocus:l,onBlur:C[0]||(C[0]=b=>u.value=!1)},y.$attrs),null,16,["value"]),M(y.$slots,"description",{},()=>[A(s).description?(k(),E("p",{key:0,class:z(["mt-1.5",o.value])},fe(A(s).description),3)):K("",!0)])],64))}},Z=Ae({});function Ct(e,t="Form"){const s=Ye({doctype:"CRM Form Script",cache:["Form Scripts",e,t],fields:["name","dt","view","script"],filters:{view:t,dt:e,enabled:1},onSuccess:b=>{for(let a of b)Z[e]||(Z[e]={}),Z[e][a.name]=a||{}},onError:b=>{console.error(`Error loading CRM Form Scripts for ${e} (view: ${t}):`,b)}});!Z[e]&&!s.loading&&s.fetch();async function u(b,a={}){await s.list.promise;let h=Z[e];if(!h||Object.keys(h).length===0)return null;const{$dialog:x,$socket:w}=Oe();return a.createDialog=x,a.toast=L,a.socket=w,a.router=Je,a.call=Qe,a.throwError=r=>{throw L.error(r||__("An error occurred")),new Error(r||__("An error occurred"))},v(h,b,a)}function v(b,a,h){var r;const x=[];let w=null;for(let f in b){let i=(r=b[f])==null?void 0:r.script;if(i)try{const d=o(i);if(!d)continue;d.forEach(_=>{const $=y(i,_,h);if(!$)return;let I=null,n=e.replace(/\s+/g,""),{doctypeMeta:m}=le(e),p=_!==n;if(p){if(!x.length){console.error(__("⚠️ No class found for doctype: {0}, it is mandatory to have a class for the parent doctype. it can be empty, but it should be present.",[e]));return}I=x[w]}else w=x.length||0;const g=l($,m,a,I,p);x.push(g)})}catch(d){console.error(__("Failed to load form controller: {0}",[d]))}}return x}function l(b,a,h,x=null,w=!1){h.actions=h.actions||[],h.statuses=h.statuses||[];let r=new b;r._originalDocumentContext=h,r._isChildDoctype=w;for(const i in h)h.hasOwnProperty(i)&&(r[i]=h[i]);r.getMeta=async i=>(a[i]||await le(i),a[i]);const f=()=>h.doc;return w?(r.doc=C(f,x,r),x._childInstances||(x._childInstances=[]),x._childInstances.push(r)):r.doc=C(f,r),r}function c(b){typeof b.prototype.getRow!="function"&&(b.prototype.getRow=function(a,h){var r,f;h=h||this.currentRowIdx;let x=null;if(this instanceof Array){const{getFields:i}=le(this.doc.doctype);let _=i().find($=>$.fieldname===a);x=(r=_==null?void 0:_.options)==null?void 0:r.replace(/\s+/g,""),!h&&x&&(h=(f=this.find($=>$.constructor.name===x))==null?void 0:f.currentRowIdx)}if(!this.doc[a])return console.warn(__("⚠️ No data found for parent field: {0}",[a])),null;const w=this.doc[a].find(i=>i.idx===h);return w?(w.parent=w.parent||this.doc.name,this instanceof Array&&x?C(w,this.find(i=>i.constructor.name===x)):C(w,this)):(console.warn(__("⚠️ No row found for idx: {0} in parent field: {1}",[h,a])),null)}),Object.prototype.hasOwnProperty.call(b.prototype,"actions")||Object.defineProperty(b.prototype,"actions",{configurable:!0,enumerable:!0,get(){return this._originalDocumentContext?this._originalDocumentContext.actions:(console.warn("CRM Script: _originalDocumentContext not found on instance for actions getter."),[])},set(a){if(!this._originalDocumentContext){console.warn("CRM Script: _originalDocumentContext not found on instance for actions setter.");return}if(!Array.isArray(a)){console.warn('CRM Script: "actions" property must be an array. Value was not set.',a),this._originalDocumentContext.actions=[];return}this._originalDocumentContext.actions=a}}),Object.prototype.hasOwnProperty.call(b.prototype,"statuses")||Object.defineProperty(b.prototype,"statuses",{configurable:!0,enumerable:!0,get(){return this._originalDocumentContext?this._originalDocumentContext.statuses:(console.warn("CRM Script: _originalDocumentContext not found on instance for statuses getter."),[])},set(a){if(!this._originalDocumentContext){console.warn("CRM Script: _originalDocumentContext not found on instance for statuses setter.");return}if(!Array.isArray(a)){console.warn('CRM Script: "statuses" property must be an array. Value was not set.',a),this._originalDocumentContext.statuses=[];return}this._originalDocumentContext.statuses=a}})}function o(b){return[...b.replace(/\/\/.*$/gm,"").replace(/\/\*[\s\S]*?\*\//g,"").matchAll(/class\s+([A-Za-z0-9_]+)/g)].map(h=>h[1])||[]}function y(b,a,h={}){const x=Object.keys(h),w=Object.values(h),r=`
		${b}
		return ${a};
	`,f=new Function(...x,r)(...w);return c(f),f}function C(b,a,h=null){const x=typeof b=="function",w=()=>x?b():b;return new Proxy({},{get(r,f){const i=w();if(i)return f==="trigger"?(i&&"trigger"in i&&console.warn(__('⚠️ Avoid using "trigger" as a field name — it conflicts with the built-in trigger() method.')),(d,..._)=>{const $=a[d];if(typeof $=="function")return $.apply(a,_);console.warn(__('⚠️ Method "{0}" not found in class.',[d]))}):f==="getRow"?a.getRow.bind(h||a._childInstances||a):i[f]},set(r,f,i){const d=w();return d?(d[f]=i,!0):!1},has(r,f){const i=w();return i?f in i:!1},ownKeys(r){const f=w();return f?Reflect.ownKeys(f):[]},getOwnPropertyDescriptor(r,f){const i=w();if(i)return Reflect.getOwnPropertyDescriptor(i,f)}})}return{scripts:s,setupScript:u,setupFormController:l}}const N={},G={},X={},ee={};function Tt(e,t,s={}){const{setupScript:u,scripts:v}=Ct(e),l=le(e);N[e]=N[e]||{};const c=S("");N[e][t||""]||(t?N[e][t]=Ze({doctype:e,name:t,onSuccess:async()=>await o(),onError:n=>{c.value=n,n.exc_type==="DoesNotExistError"&&L.error(__(n.messages[0]||"Document does not exist")),n.exc_type==="PermissionError"&&L.error(__(n.messages[0]||"You do not have permission to access this document"))},setValue:{validate:C,onSuccess:()=>{x(),L.success(__("Document updated successfully"))},onError:n=>{var m,p;if(w(),n.exc_type=="MandatoryError"){const g=n.messages.map(O=>{let T=O.split(": ");return T[T.length-1].trim()}).join(", ");L.error(__("Mandatory field error: {0}",[g]));return}(m=n.messages)==null||m.forEach(g=>{L.error(g)}),((p=n.messages)==null?void 0:p.length)===0&&L.error(__("An error occurred while updating the document")),console.error(n)}},...s}):(N[e][""]=Ae({doc:{}}),o())),X[e]=X[e]||{},X[e][t||""]||(X[e][t||""]=be({url:"crm.api.doc.get_assigned_users",cache:`assignees:${e}:${t}`,auto:!!t,params:{doctype:e,name:t},transform:n=>Xe(n)})),ee[e]=ee[e]||{},ee[e][t||""]||(ee[e][t||""]=be({url:"frappe.client.get_doc_permissions",cache:`permissions:${e}:${t}`,auto:!!t,params:{doctype:e,docname:t},initialData:{permissions:{}}}));async function o(){if(G[e]&&typeof G[e][t||""]=="object")return;G[e]||(G[e]={}),G[e][t||""]={};const{makeCall:n}=Oe();let m={};m.crm={makePhoneCall:n,openSettings:O=>{at.value=!0,nt.value=O}};const p=await u(N[e][t||""],m);if(!p||p.length===0)return;const g={};for(const O of p){const T=O.constructor.name;g[T]||(g[T]=[]),g[T].push(O)}G[e][t||""]=g,a()}function y(n=null){var O;const p=((n==null?void 0:n.doctype)||e).replace(/\s+/g,""),g=(O=G[e])==null?void 0:O[t||""];return typeof g=="object"&&g!==null&&!Array.isArray(g)?g[p]||[]:[]}function C(n){b(n.doc||n.fieldname)}function b(n){let m=(l==null?void 0:l.getFields())||[];if(!m||m.length===0)return;let p=[];if(m.forEach(g=>{var T;let O=((T=l==null?void 0:l.doctypeMeta)==null?void 0:T[g.parent])||null;if(et(g.mandatory_depends_on,n,O)){const U=n[g.fieldname];(U==null||typeof U=="string"&&U.trim()===""||Array.isArray(U)&&U.length===0)&&p.push(g.label||g.fieldname)}}),p.length>0)throw L.error(__("Mandatory fields required: {0}",[p.join(", ")])),new Error(__("Mandatory fields required: {0}",[p.join(", ")]))}async function a(){await I(async function(){var m,p,g;await(((m=this.onLoad)==null?void 0:m.call(this))||((p=this.on_load)==null?void 0:p.call(this))||((g=this.onload)==null?void 0:g.call(this)))})}async function h(){const n=Array.from(arguments);await I(async function(){var p,g;await(((p=this.onBeforeCreate)==null?void 0:p.call(this,...n))||((g=this.on_before_create)==null?void 0:g.call(this,...n)))})}async function x(){await I(async function(){var m,p;await(((m=this.onSave)==null?void 0:m.call(this))||((p=this.on_save)==null?void 0:p.call(this)))})}async function w(){await I(async function(){var m,p;await(((m=this.onError)==null?void 0:m.call(this))||((p=this.on_error)==null?void 0:p.call(this)))})}async function r(){await I(async function(){var m;await((m=this.refresh)==null?void 0:m.call(this))})}async function f(n,m,p){let g=null;p?(g=p[n],p[n]=m):(g=N[e][t||""].doc[n],N[e][t||""].doc[n]=m);const O=async function(){var T;this.value=m,this.oldValue=g,p&&(this.currentRowIdx=p.idx),await((T=this[n])==null?void 0:T.call(this))};try{await I(O,p)}catch(T){throw p?p[n]=g:N[e][t||""].doc[n]=g,console.error(O),T}}async function i(n){await I(async function(){var p;this.currentRowIdx=n.idx,this.value=n,await((p=this[n.parentfield+"_add"])==null?void 0:p.call(this))},n)}async function d(n,m){await I(async function(){var g;if(n.size===1){const O=Array.from(n)[0];this.currentRowIdx=m.find(T=>T.name===O).idx}else delete this.currentRowIdx;this.selectedRows=Array.from(n),this.rows=m,await((g=this[m[0].parentfield+"_remove"])==null?void 0:g.call(this))},m[0])}async function _(){const n=Array.from(arguments);await I(async function(){var p,g;await(((p=this.onCreateLead)==null?void 0:p.call(this,...n))||((g=this.on_create_lead)==null?void 0:g.call(this,...n)))})}async function $(){const n=Array.from(arguments);await I(async function(){var p,g;await(((p=this.convertToDeal)==null?void 0:p.call(this,...n))||((g=this.convert_to_deal)==null?void 0:g.call(this,...n)))})}async function I(n,m=null){const p=y(m);if(!p.length)return;const g=p.map(O=>async()=>await n.call(O));await tt(g)}return{document:N[e][t||""],assignees:X[e][t||""],permissions:ee[e][t||""],scripts:v,error:c,validate:C,getControllers:y,triggerOnLoad:a,triggerOnBeforeCreate:h,triggerOnSave:x,triggerOnError:w,triggerOnRefresh:r,triggerOnChange:f,triggerOnRowAdd:i,triggerOnRowRemove:d,setupFormScript:o,triggerOnCreateLead:_,triggerConvertToDeal:$}}const Rt=S(!1),Et=S({}),Mt=S(!1),Ft=S({}),Bt=S(!1),Nt=S(!1);export{Pt as _,Ft as a,Dt as b,Rt as c,pt as d,vt as e,Ot as f,At as g,Nt as h,Bt as i,Et as q,Mt as s,Tt as u};
//# sourceMappingURL=modals-47f1cf8a.js.map

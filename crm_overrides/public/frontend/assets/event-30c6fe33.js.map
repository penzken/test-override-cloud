{"version":3,"file":"event-30c6fe33.js","sources":["../../../../frontend/src/components/Calendar/Attendee.vue","../../../../frontend/src/components/Calendar/utils.js","../../../../frontend/src/composables/event.js"],"sourcesContent":["<template>\n  <div>\n    <!-- Combobox Input -->\n    <div class=\"flex items-center w-full text-ink-gray-8 [&>div]:w-full\">\n      <ComboboxRoot\n        :model-value=\"tempSelection\"\n        :open=\"showOptions\"\n        @update:open=\"(o) => (showOptions = o)\"\n        @update:modelValue=\"onSelect\"\n        :ignore-filter=\"true\"\n      >\n        <ComboboxAnchor\n          class=\"flex w-full text-base items-center gap-1 rounded border border-outline-gray-2 bg-surface-white hover:border-outline-gray-3 focus:border-outline-gray-4 focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3 px-2 py-1\"\n          :class=\"[size === 'sm' ? 'h-7' : 'h-8 ', inputClass]\"\n          @click=\"showOptions = true\"\n        >\n          <ComboboxInput\n            ref=\"search\"\n            autocomplete=\"off\"\n            class=\"bg-transparent p-0 outline-none border-0 text-base text-ink-gray-8 h-full placeholder:text-ink-gray-4 w-full focus:outline-none focus:ring-0 focus:border-0\"\n            :placeholder=\"placeholder\"\n            :value=\"query\"\n            @input=\"onInput\"\n            @keydown.enter.prevent=\"handleEnter\"\n            @keydown.escape.stop=\"showOptions = false\"\n          />\n          <FeatherIcon\n            name=\"chevron-down\"\n            class=\"h-4 text-ink-gray-5 cursor-pointer\"\n            @click.stop=\"showOptions = !showOptions\"\n          />\n        </ComboboxAnchor>\n        <ComboboxPortal>\n          <ComboboxContent\n            class=\"z-10 mt-1 min-w-48 w-full max-w-md bg-surface-modal overflow-hidden rounded-lg shadow-2xl ring-1 ring-black ring-opacity-5\"\n            position=\"popper\"\n            :align=\"'start'\"\n            @openAutoFocus.prevent\n            @closeAutoFocus.prevent\n          >\n            <ComboboxViewport class=\"max-h-60 overflow-auto p-1.5\">\n              <ComboboxEmpty\n                class=\"flex gap-2 rounded px-2 py-1 text-base text-ink-gray-5\"\n              >\n                <FeatherIcon v-if=\"fetchContacts\" name=\"search\" class=\"h-4\" />\n                {{ emptyStateText }}\n              </ComboboxEmpty>\n              <ComboboxItem\n                v-for=\"option in options\"\n                :key=\"option.value\"\n                :value=\"option.value\"\n                class=\"text-base leading-none text-ink-gray-7 rounded flex items-center px-2 py-1 relative select-none data-[highlighted]:outline-none data-[highlighted]:bg-surface-gray-3 cursor-pointer\"\n                @mousedown.prevent=\"onSelect(option.value, option)\"\n              >\n                <UserAvatar class=\"mr-2\" :user=\"option.value\" size=\"lg\" />\n                <div class=\"flex flex-col gap-1 p-1 text-ink-gray-8\">\n                  <div class=\"text-base font-medium\">{{ option.label }}</div>\n                  <div class=\"text-sm text-ink-gray-5\">{{ option.value }}</div>\n                </div>\n              </ComboboxItem>\n            </ComboboxViewport>\n          </ComboboxContent>\n        </ComboboxPortal>\n      </ComboboxRoot>\n    </div>\n\n    <!-- Selected Attendees -->\n    <div\n      v-if=\"values.length\"\n      class=\"flex flex-col gap-2 mt-2 max-h-[165px] overflow-y-auto\"\n      ref=\"optionsRef\"\n    >\n      <Button\n        ref=\"emails\"\n        v-for=\"att in values\"\n        :key=\"att.email\"\n        :label=\"att.email\"\n        theme=\"gray\"\n        class=\"rounded-full w-fit\"\n        :tooltip=\"getTooltip(att.email)\"\n      >\n        <template #prefix>\n          <UserAvatar :user=\"att.email\" class=\"-ml-1 !size-5.5\" />\n        </template>\n        <template #suffix>\n          <FeatherIcon\n            class=\"h-3.5\"\n            name=\"x\"\n            @click.stop=\"removeValue(att.email)\"\n          />\n        </template>\n      </Button>\n      <ErrorMessage class=\"mt-2 pl-2\" v-if=\"error\" :message=\"error\" />\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport UserAvatar from '@/components/UserAvatar.vue'\nimport { createResource } from 'frappe-ui'\nimport {\n  ComboboxRoot,\n  ComboboxAnchor,\n  ComboboxInput,\n  ComboboxPortal,\n  ComboboxContent,\n  ComboboxViewport,\n  ComboboxItem,\n  ComboboxEmpty,\n} from 'reka-ui'\nimport { ref, computed, nextTick } from 'vue'\nimport { watchDebounced } from '@vueuse/core'\n\nconst props = defineProps({\n  validate: {\n    type: Function,\n    default: null,\n  },\n  variant: {\n    type: String,\n    default: 'subtle',\n  },\n  size: {\n    type: String,\n    default: 'sm',\n  },\n  placeholder: {\n    type: String,\n    default: 'Add attendee',\n  },\n  inputClass: {\n    type: String,\n    default: '',\n  },\n  errorMessage: {\n    type: Function,\n    default: (value) => `${value} is an Invalid value`,\n  },\n  fetchContacts: {\n    type: Boolean,\n    default: true,\n  },\n  existingEmails: {\n    type: Array,\n    default: () => [],\n  },\n})\n\nconst values = defineModel()\n\nconst emails = ref([])\nconst search = ref(null)\nconst error = ref(null)\nconst info = ref(null)\nconst query = ref('')\nconst text = ref('')\nconst showOptions = ref(false)\nconst optionsRef = ref(null)\nconst tempSelection = ref(null)\n\nconst metaByEmail = computed(() => {\n  const out = {}\n  const source = values.value || []\n  for (const a of source) {\n    if (a?.email) out[a.email] = a\n  }\n  return out\n})\n\nfunction getTooltip(email) {\n  const m = metaByEmail.value[email]\n  if (!m) return email\n  const parts = []\n  if (m.reference_doctype) parts.push(m.reference_doctype)\n  if (m.reference_docname) parts.push(m.reference_docname)\n  return parts.length ? parts.join(': ') : email\n}\n\nwatchDebounced(\n  query,\n  (val) => {\n    val = val || ''\n    if (text.value === val && options.value?.length) return\n    text.value = val\n    reload(val)\n  },\n  { debounce: 300, immediate: true },\n)\n\nconst filterOptions = createResource({\n  url: 'crm.api.contact.search_emails',\n  method: 'POST',\n  cache: [text.value, 'Contact'],\n  params: { txt: text.value },\n  transform: (data) => {\n    let allData = data.map((option) => {\n      let fullName = option[0]\n      let email = option[1]\n      let name = option[2]\n      return {\n        label: fullName || name || email,\n        name: name,\n        value: email,\n      }\n    })\n\n    // Filter out existing emails\n    if (props.existingEmails?.length) {\n      allData = allData.filter((option) => {\n        return !props.existingEmails.includes(option.value)\n      })\n    }\n\n    return allData\n  },\n})\n\nconst options = computed(() => {\n  let searchedContacts = props.fetchContacts ? filterOptions.data : []\n  if (!searchedContacts?.length && query.value) {\n    searchedContacts.push({\n      name: 'new',\n      label: query.value,\n      value: query.value,\n    })\n  }\n  return searchedContacts || []\n})\n\nconst emptyStateText = computed(() =>\n  props.fetchContacts\n    ? __('No results found')\n    : __('Type an email address to add attendee'),\n)\n\nfunction reload(val) {\n  if (!props.fetchContacts) return\n\n  filterOptions.update({\n    params: { txt: val },\n  })\n  filterOptions.reload()\n}\n\nfunction onSelect(val, fullOption = null) {\n  if (!val) return\n  const optionObj = fullOption ||\n    options.value.find((o) => o.value === val) || {\n      name: 'new',\n      label: val,\n      value: val,\n    }\n  addValue(optionObj)\n  if (!error.value) {\n    query.value = ''\n    tempSelection.value = null\n    showOptions.value = false\n    nextTick(() => setFocus())\n  }\n}\n\nfunction handleEnter() {\n  if (query.value) {\n    onSelect(query.value, {\n      name: 'new',\n      label: query.value,\n      value: query.value,\n    })\n  }\n}\n\nfunction onInput(e) {\n  query.value = e.target.value\n  showOptions.value = true\n}\n\nconst addValue = (option) => {\n  // Safeguard for falsy option\n  if (!option || !option.value) return\n\n  error.value = null\n  info.value = null\n\n  const current = Array.isArray(values.value) ? values.value.slice() : []\n  const existing = new Set(current.map((a) => a.email))\n\n  const raw = option.value || ''\n  const parts = raw.split(',')\n  const hasMultiple = parts.length > 1\n\n  for (let p of parts) {\n    p = p.trim()\n    if (!p) continue\n    if (existing.has(p)) {\n      info.value = __('email already exists')\n      continue\n    }\n    if (props.validate && !props.validate(p)) {\n      error.value = props.errorMessage(p)\n      query.value = p\n      continue\n    }\n    existing.add(p)\n    const entry = { email: p }\n\n    if (option.name && !hasMultiple) {\n      entry.reference_docname = option.name\n    }\n    current.push(entry)\n  }\n\n  values.value = current\n  // Scroll to the bottom so the last added value is visible\n  nextTick(() => {\n    // use requestAnimationFrame to ensure DOM paint\n    requestAnimationFrame(() => {\n      const el = optionsRef.value\n      if (el) {\n        el.scrollTo({ top: el.scrollHeight, behavior: 'smooth' })\n      }\n    })\n  })\n}\n\nconst removeValue = (email) => {\n  values.value = (values.value || []).filter((a) => a.email !== email)\n}\n\nfunction setFocus() {\n  search.value?.focus?.()\n}\n\ndefineExpose({ setFocus })\n</script>\n","export function allTimeSlots() {\n  const out = []\n  for (let h = 0; h < 24; h++) {\n    for (const m of [0, 15, 30, 45]) {\n      const hh = String(h).padStart(2, '0')\n      const mm = String(m).padStart(2, '0')\n      const ampm = h >= 12 ? 'pm' : 'am'\n      const hour12 = h % 12 === 0 ? 12 : h % 12\n      out.push({\n        value: `${hh}:${mm}`,\n        label: `${hour12}:${mm} ${ampm}`,\n      })\n    }\n  }\n  return out\n}\n","import { usersStore } from '@/stores/users'\nimport { dayjs, createListResource } from 'frappe-ui'\nimport { sameArrayContents } from '@/utils'\nimport { computed, ref } from 'vue'\nimport { allTimeSlots } from '@/components/Calendar/utils'\n\nexport const showEventModal = ref(false)\nexport const activeEvent = ref(null)\n\nexport function useEvent(doctype, docname) {\n  const { getUser } = usersStore()\n\n  const eventsResource = createListResource({\n    doctype: 'Event',\n    cache: ['calendar', docname],\n    fields: [\n      'name',\n      'status',\n      'subject',\n      'description',\n      'starts_on',\n      'ends_on',\n      'all_day',\n      'event_type',\n      'color',\n      'owner',\n      'reference_doctype',\n      'reference_docname',\n      'creation',\n    ],\n    filters: {\n      reference_doctype: doctype,\n      reference_docname: docname,\n    },\n    auto: true,\n    orderBy: 'creation desc',\n    onSuccess: (d) => {\n      console.log(d)\n    },\n  })\n\n  const eventParticipantsResource = createListResource({\n    doctype: 'Event Participants',\n    fields: ['*'],\n    parent: 'Event',\n  })\n\n  const events = computed(() => {\n    if (!eventsResource.data) return []\n    const eventNames = eventsResource.data.map((e) => e.name)\n    if (\n      !eventParticipantsResource.data?.length ||\n      eventsParticipantIsUpdated(eventNames)\n    ) {\n      eventParticipantsResource.update({\n        filters: {\n          parenttype: 'Event',\n          parentfield: 'event_participants',\n          parent: ['in', eventNames],\n        },\n      })\n      !eventParticipantsResource.list.loading &&\n        eventParticipantsResource.reload()\n    } else {\n      eventsResource.data.forEach((event) => {\n        if (typeof event.owner !== 'object') {\n          event.owner = {\n            label: getUser(event.owner).full_name,\n            image: getUser(event.owner).user_image,\n            name: event.owner,\n          }\n        }\n\n        event.event_participants = [\n          ...eventParticipantsResource.data.filter(\n            (participant) => participant.parent === event.name,\n          ),\n        ]\n\n        event.participants = [\n          event.owner,\n          ...eventParticipantsResource.data\n            .filter((participant) => participant.parent === event.name)\n            .map((participant) => ({\n              label: getUser(participant.email).full_name || participant.email,\n              image: getUser(participant.email).user_image || '',\n              name: participant.email,\n            })),\n        ]\n      })\n    }\n\n    return eventsResource.data\n  })\n\n  function eventsParticipantIsUpdated(eventNames) {\n    const parentFilter = eventParticipantsResource.filters?.parent?.[1]\n\n    if (eventNames.length && !sameArrayContents(parentFilter, eventNames))\n      return true\n\n    let d = eventsResource.setValue.data\n    if (!d) return false\n\n    let newParticipants = d.event_participants.map((p) => p.name)\n    let oldParticipants = eventParticipantsResource.data\n      .filter((p) => p.parent === d.name)\n      .map((p) => p.name)\n\n    return !sameArrayContents(newParticipants, oldParticipants)\n  }\n\n  const startEndTime = (\n    startTime,\n    endTime,\n    isFullDay = false,\n    format = 'h:mm a',\n  ) => {\n    const start = dayjs(startTime)\n    const end = dayjs(endTime)\n\n    if (isFullDay) return __('All day')\n\n    return `${start.format(format)} - ${end.format(format)}`\n  }\n\n  const startDate = (startTime, format = 'ddd, D MMM YYYY') => {\n    const start = dayjs(startTime)\n    return start.format(format)\n  }\n\n  return {\n    eventsResource,\n    eventParticipantsResource,\n    events,\n    startEndTime,\n    startDate,\n  }\n}\n\nexport function normalizeParticipants(list = []) {\n  const seen = new Set()\n  const out = []\n  for (const a of list || []) {\n    if (!a?.email || seen.has(a.email)) continue\n    seen.add(a.email)\n    out.push({\n      email: a.email,\n      reference_doctype: a.reference_doctype || 'Contact',\n      reference_docname: a.reference_docname || '',\n    })\n  }\n  return out\n}\n\nexport function formatDuration(mins) {\n  if (mins < 60) return __('{0} mins', [mins])\n  let hours = mins / 60\n  if (hours % 1 !== 0 && hours % 1 !== 0.5) {\n    hours = hours.toFixed(2)\n  }\n  if (Number.isInteger(hours)) {\n    return hours === 1 ? __('1 hr') : __('{0} hrs', [hours])\n  }\n  return `${hours} hrs`\n}\n\nexport function buildEndTimeOptions(fromTime) {\n  const timeSlots = allTimeSlots()\n  if (!fromTime) return timeSlots\n  const startIndex = timeSlots.findIndex((o) => o.value > fromTime)\n  if (startIndex === -1) return []\n  const [fh, fm] = fromTime.split(':').map((n) => parseInt(n))\n  const fromTotal = fh * 60 + fm\n  return timeSlots.slice(startIndex).map((o) => {\n    const [th, tm] = o.value.split(':').map((n) => parseInt(n))\n    const toTotal = th * 60 + tm\n    const duration = toTotal - fromTotal\n    return { ...o, label: `${o.label} (${formatDuration(duration)})` }\n  })\n}\n\nexport function computeAutoToTime(fromTime) {\n  if (!fromTime) return ''\n  const [hour, minute] = fromTime.split(':').map((n) => parseInt(n))\n  let nh = hour + 1\n  let nm = minute\n  if (nh >= 24) {\n    nh = 23\n    nm = 59\n  }\n  return `${String(nh).padStart(2, '0')}:${String(nm).padStart(2, '0')}`\n}\n\nexport function validateTimeRange({ fromDate, fromTime, toTime, isFullDay }) {\n  if (isFullDay) return { valid: true, error: null }\n  if (!fromTime || !toTime) {\n    return { valid: false, error: __('Start and end time are required') }\n  }\n  const start = dayjs(fromDate + ' ' + fromTime)\n  const end = dayjs(fromDate + ' ' + toTime)\n  if (!start.isValid() || !end.isValid()) {\n    return { valid: false, error: __('Invalid start or end time') }\n  }\n  if (end.diff(start, 'minute') <= 0) {\n    return { valid: false, error: __('End time should be after start time') }\n  }\n  return { valid: true, error: null }\n}\n\nexport function parseEventDoc(doc) {\n  if (!doc) return {}\n  const { getUser } = usersStore()\n  return {\n    id: doc.name,\n    title: doc.subject,\n    description: doc.description,\n    status: doc.status,\n    fromDate: dayjs(doc.starts_on).format('YYYY-MM-DD'),\n    toDate: dayjs(doc.ends_on).format('YYYY-MM-DD'),\n    fromTime: dayjs(doc.starts_on).format('HH:mm'),\n    toTime: dayjs(doc.ends_on).format('HH:mm'),\n    isFullDay: doc.all_day,\n    eventType: doc.event_type,\n    color: doc.color,\n    referenceDoctype: doc.reference_doctype,\n    referenceDocname: doc.reference_docname,\n    event_participants: doc.event_participants || [],\n    owner: doc.owner\n      ? {\n          label: getUser(doc.owner).full_name,\n          image: getUser(doc.owner).user_image,\n          value: doc.owner,\n        }\n      : null,\n  }\n}\n"],"names":["props","__props","values","_useModel","emails","ref","search","error","info","query","text","showOptions","optionsRef","tempSelection","metaByEmail","computed","out","source","a","getTooltip","email","m","parts","watchDebounced","val","_a","options","reload","filterOptions","createResource","data","allData","option","fullName","name","searchedContacts","emptyStateText","onSelect","fullOption","optionObj","o","addValue","nextTick","setFocus","handleEnter","onInput","e","current","existing","hasMultiple","p","entry","el","removeValue","_b","__expose","_createElementBlock","_createElementVNode","_hoisted_1","_createVNode","_unref","ComboboxRoot","_cache","ComboboxAnchor","_normalizeClass","ComboboxInput","_component_FeatherIcon","_withModifiers","$event","ComboboxPortal","ComboboxContent","ComboboxViewport","ComboboxEmpty","_createBlock","_createTextVNode","_Fragment","_renderList","ComboboxItem","UserAvatar","_hoisted_2","_hoisted_3","_toDisplayString","_hoisted_4","att","_component_Button","_component_ErrorMessage","allTimeSlots","h","hh","mm","ampm","hour12","showEventModal","activeEvent","useEvent","doctype","docname","getUser","usersStore","eventsResource","createListResource","d","eventParticipantsResource","events","eventNames","eventsParticipantIsUpdated","event","participant","parentFilter","sameArrayContents","newParticipants","oldParticipants","startTime","endTime","isFullDay","format","start","dayjs","end","normalizeParticipants","list","seen","formatDuration","mins","hours","buildEndTimeOptions","fromTime","timeSlots","startIndex","fh","fm","n","fromTotal","th","tm","duration","computeAutoToTime","hour","minute","nh","nm","validateTimeRange","fromDate","toTime","parseEventDoc","doc"],"mappings":"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"}
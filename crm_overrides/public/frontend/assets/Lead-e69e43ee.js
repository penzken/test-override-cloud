import{a as ye}from"./DeleteLinkedDocModal-58bed83f.js";import{_ as be}from"./ErrorPage-f1ea6704.js";import{_ as he}from"./Icon-f8d63d14.js";import{_ as Ce}from"./Resizer-850b6a12.js";import{A as ke,E as we,a as te,u as xe,_ as Me,b as Ee,c as Ie,S as Ve}from"./useActiveTabManager-ba8c3899.js";import{E as Le}from"./EmailMultiSelect-9a571b70.js";import{E as $e}from"./Email2Icon-e5467a9c.js";import{C as Re}from"./CommentIcon-1ba1196a.js";import{D as De}from"./DetailsIcon-18759e5d.js";import{P as oe}from"./PhoneIcon-687b9433.js";import{T as Se}from"./TaskIcon-4d1dfaf1.js";import{N as Ae}from"./NoteModal-52dadb54.js";import{W as Te}from"./WhatsAppIcon-bde39cdc.js";import{I as ze}from"./IndicatorIcon-2f30d1a9.js";import{C as qe}from"./CameraIcon-39bf1b22.js";import{L as Oe}from"./LinkIcon-6ec44f2a.js";import{L as Ue}from"./LayoutHeader-0ab09138.js";import{g as Fe,S as Ne}from"./view-d56bbd34.js";import{_ as le}from"./CustomActions-faabd076.js";import{O as Be}from"./OrganizationsIcon-d184acc0.js";import{C as Pe}from"./ContactsIcon-e88572ff.js";import{E as je}from"./EditIcon-127a74cc.js";import{F as We}from"./FieldLayout-baadb8ff.js";import{L as se}from"./Link-a0855a11.js";import{u as ee,c as He,q as Qe,_ as Ge}from"./modals-47f1cf8a.js";import{O as Ke,P as Xe,aM as de,a0 as Ye,a2 as Je,m as b,z as A,Y as ce,e as H,f as i,g as d,w as p,d as u,t as I,u as o,C as m,b as n,c as O,X as Ze,aS as me,aV as ea,a1 as aa,A as ne,aU as ta,aK as ie,F as oa,aT as q,n as la,L as sa,a8 as na,$ as ia,H as ra}from"./index-a6920b9f.js";import{s as ve}from"./statuses-57fa655e.js";import{i as ua,w as da,c as ca}from"./DragVerticalIcon-3e35903f.js";import{e as re,b as ma,s as va,D as ue,i as pa,h as fa,a as _a,o as ga}from"./index-8df5241e.js";import{u as ya}from"./helpCenter-a7e44f6b.js";import{g as ba}from"./settings-97110a1e.js";import{g as ha}from"./global-0d0156ec.js";import{_ as Ca}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-7d13eeef.js";import{F as ka}from"./FileUploader-28868f3a.js";import{u as wa}from"./pageMeta-16e1c7dd.js";import"./ListView-3ebdc383.js";import"./CalendarIcon-28657f45.js";import"./CallLogModal-50e95440.js";import"./ArrowUpRightIcon-992c4380.js";import"./LeadsIcon-fdfd4494.js";import"./DealsIcon-97fb4069.js";import"./TaskModal-03a6c87c.js";import"./TextEditor.vue_vue_type_script_setup_true_lang-0d82d5b6.js";import"./FadedScrollableDiv-6f6cd639.js";import"./MultipleAvatar-3dcbfb2e.js";import"./event-2ffbd56c.js";import"./ComboboxViewport-5c5445f5.js";import"./IconPicker-929f64f0.js";const xa={class:"mb-6 flex items-center justify-between"},Ma={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},Ea={class:"flex items-center gap-1"},Ia={class:"mb-4 flex items-center gap-2 text-ink-gray-5"},Va={class:"block text-base"},La={class:"ml-6 text-ink-gray-9"},$a={class:"flex items-center justify-between text-base"},Ra={key:1,class:"mt-2.5 text-base"},Da={class:"mb-4 mt-6 flex items-center gap-2 text-ink-gray-5"},Sa={class:"block text-base"},Aa={class:"ml-6 text-ink-gray-9"},Ta={class:"flex items-center justify-between text-base"},za={key:1,class:"mt-2.5 text-base"},qa={key:0,class:"h-px w-full border-t my-6"},Oa={class:"flex justify-end"},Ua={__name:"ConvertToDealModal",props:Ke({lead:{type:Object,required:!0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(h){const U=h,V=Xe(h,"modelValue"),Q=de(),{statusOptions:G,getDealStatus:K}=ve(),{isManager:X}=Ye(),{user:Y}=Je(),{updateOnboardingStep:L}=ya("frappecrm"),$=b(!1),x=b(!1),C=b(""),f=b(""),v=b(""),{triggerConvertToDeal:R}=ee("CRM Lead",U.lead.name),{document:_}=ee("CRM Deal");async function T(){if(v.value="",$.value&&!C.value){v.value=__("Please select an existing contact");return}if(x.value&&!f.value){v.value=__("Please select an existing organization");return}!$.value&&C.value&&(C.value=""),!x.value&&f.value&&(f.value=""),await(R==null?void 0:R(U.lead,_.doc,()=>V.value=!1));let r=await me("crm.fcrm.doctype.crm_lead.crm_lead.convert_to_deal",{lead:U.lead.name,deal:_.doc,existing_contact:C.value,existing_organization:f.value}).catch(t=>{var k;if(t.exc_type=="MandatoryError"){const E=t.messages.map(g=>{let l=g.split(": ");return l[l.length-1].trim()}).join(", ");E.toLowerCase().includes("required")?v.value=__(E):v.value=__("{0} is required",[E]);return}v.value=__("Error converting to deal: {0}",[(k=t.messages)==null?void 0:k[0]])});r&&(V.value=!1,$.value=!1,x.value=!1,C.value="",f.value="",v.value="",L("convert_lead_to_deal",!0,!1,()=>{localStorage.setItem("firstDeal"+Y,r)}),ea("convert_lead_to_deal"),Q.push({name:"Deal",params:{dealId:r}}))}const F=A(()=>{var t;let r=G("deal");return(t=_.doc)!=null&&t.status||(_.doc.status=r[0].value),r}),N=ce({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["RequiredFields","CRM Deal"],params:{doctype:"CRM Deal",type:"Required Fields"},auto:!0,transform:r=>{let t=!1,k=r==null?void 0:r.forEach(E=>{var g;(g=E.sections)==null||g.forEach(l=>{var y;(y=l.columns)==null||y.forEach(z=>{var j;(j=z.fields)==null||j.forEach(w=>{t=!0,w.fieldname=="status"&&(w.fieldtype="Select",w.options=F.value,w.prefix=K(_.doc.status).color),w.fieldtype==="Table"&&(_.doc[w.fieldname]=[])})})})});return t?k:[]}});function B(){He.value=!0,Qe.value={doctype:"CRM Deal",onlyRequired:!0},V.value=!1}return(r,t)=>{const k=H("Button"),E=H("ErrorMessage");return i(),d(o(Ze),{modelValue:V.value,"onUpdate:modelValue":t[5]||(t[5]=g=>V.value=g),options:{size:"xl"}},{"body-header":p(()=>[u("div",xa,[u("div",null,[u("h3",Ma,I(r.__("Convert to Deal")),1)]),u("div",Ea,[o(X)()&&!o(ua)?(i(),d(k,{key:0,variant:"ghost",tooltip:r.__("Edit deal's mandatory fields layout"),icon:je,onClick:B},null,8,["tooltip"])):m("",!0),n(k,{icon:"x",variant:"ghost",onClick:t[0]||(t[0]=g=>V.value=!1)})])])]),"body-content":p(()=>{var g,l;return[u("div",Ia,[n(Be,{class:"h-4 w-4"}),u("label",Va,I(r.__("Organization")),1)]),u("div",La,[u("div",$a,[u("div",null,I(r.__("Choose Existing")),1),n(o(re),{modelValue:x.value,"onUpdate:modelValue":t[1]||(t[1]=y=>x.value=y)},null,8,["modelValue"])]),x.value?(i(),d(se,{key:0,class:"form-control mt-2.5",size:"md",value:f.value,doctype:"CRM Organization",onChange:t[2]||(t[2]=y=>f.value=y)},null,8,["value"])):(i(),O("div",Ra,I(r.__("New organization will be created based on the data in details section")),1))]),u("div",Da,[n(Pe,{class:"h-4 w-4"}),u("label",Sa,I(r.__("Contact")),1)]),u("div",Aa,[u("div",Ta,[u("div",null,I(r.__("Choose Existing")),1),n(o(re),{modelValue:$.value,"onUpdate:modelValue":t[3]||(t[3]=y=>$.value=y)},null,8,["modelValue"])]),$.value?(i(),d(se,{key:0,class:"form-control mt-2.5",size:"md",value:C.value,doctype:"Contact",onChange:t[4]||(t[4]=y=>C.value=y)},null,8,["value"])):(i(),O("div",za,I(r.__("New contact will be created based on the person's details")),1))]),(g=o(N).data)!=null&&g.length?(i(),O("div",qa)):m("",!0),(l=o(N).data)!=null&&l.length?(i(),d(We,{key:1,tabs:o(N).data,data:o(_).doc,doctype:"CRM Deal"},null,8,["tabs","data"])):m("",!0),n(E,{class:"mt-4",message:v.value},null,8,["message"])]}),actions:p(()=>[u("div",Oa,[n(k,{label:r.__("Convert"),variant:"solid",onClick:T},null,8,["label"])])]),_:1},8,["modelValue"])}}},Fa={key:0,class:"flex h-full overflow-hidden"},Na={class:"flex items-center justify-start gap-5 border-b p-5"},Ba={class:"group relative size-12"},Pa={class:"z-1 absolute bottom-0.5 left-0 right-0.5 flex h-9 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-3 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(12px 0 0 0)","clip-path":"inset(12px 0 0 0)"}},ja={class:"flex flex-col gap-2.5 truncate"},Wa={class:"truncate text-2xl font-medium text-ink-gray-9"},Ha={class:"flex gap-1.5"},Qa={key:1,class:"flex flex-1 flex-col justify-between overflow-hidden"},Bt={__name:"Lead",props:{leadId:{type:String,required:!0}},setup(h){const{brand:U}=ba(),{$dialog:V,$socket:Q,makeCall:G}=ha(),{statusOptions:K,getLeadStatus:X}=ve(),{doctypeMeta:Y}=ma("CRM Lead"),L=aa(),$=de(),x=h,C=b(!1),f=b(null),v=b(""),R=b(""),_=b(!1),T=b(!1),F=b(!1),{triggerOnChange:N,assignees:B,permissions:r,document:t,scripts:k,error:E}=ee("CRM Lead",x.leadId),g=A(()=>{var e,a;return((a=(e=r.data)==null?void 0:e.permissions)==null?void 0:a.delete)||!1}),l=A(()=>t.doc||{});ne(E,e=>{var a;e?(v.value=__(e.exc_type=="DoesNotExistError"?"Document not found":"Error occurred"),R.value=__(((a=e.messages)==null?void 0:a[0])||"An error occurred")):(v.value="",R.value="")}),ne(()=>t.doc,async e=>{var a;if((a=k.data)!=null&&a.length){let c=await va(k.data,{doc:e,$dialog:V,$socket:Q,router:$,toast:q,updateField:W,createToast:q.create,deleteDoc:ae,call:me});t._actions=c.actions||[],t._statuses=c.statuses||[]}},{once:!0});const y=A(()=>{let e=[{label:__("Leads"),route:{name:"Leads"}}];if(L.query.view||L.query.viewType){let a=Fe(L.query.view,L.query.viewType,"CRM Lead");a&&e.push({label:__(a.label),icon:a.icon,route:{name:"Leads",params:{viewType:L.query.viewType},query:{view:L.query.view}}})}return e.push({label:z.value,route:{name:"Lead",params:{leadId:x.leadId}}}),e}),z=A(()=>{var a,c;let e=((a=Y["CRM Lead"])==null?void 0:a.title_field)||"name";return((c=l.value)==null?void 0:c[e])||x.leadId}),j=A(()=>{var a;let e=(a=t.statuses)!=null&&a.length?t.statuses:t._statuses||[];return K("lead",e,fe)});wa(()=>({title:z.value,icon:U.favicon}));const w=A(()=>[{name:"Activity",label:__("Activity"),icon:ke},{name:"Emails",label:__("Emails"),icon:Le},{name:"Comments",label:__("Comments"),icon:Re},{name:"Data",label:__("Data"),icon:De},{name:"Events",label:__("Events"),icon:we},{name:"Calls",label:__("Calls"),icon:oe},{name:"Tasks",label:__("Tasks"),icon:Se},{name:"Notes",label:__("Notes"),icon:Ae},{name:"Attachments",label:__("Attachments"),icon:te},{name:"WhatsApp",label:__("WhatsApp"),icon:Te,condition:()=>da.value}].filter(a=>a.condition?a.condition():!0)),{tabIndex:D,changeTabTo:pe}=xe(w,"lastLeadTab"),J=ce({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections",cache:["sidePanelSections","CRM Lead"],params:{doctype:"CRM Lead"},auto:!0});async function fe(e){await N("status",e),t.save.submit()}function W(e,a){a=Array.isArray(e)?"":a;let c=Array.isArray(e)?{}:l.value[e];Array.isArray(e)?e.forEach(P=>l.value[P]=a):l.value[e]=a,t.save.submit(null,{onSuccess:()=>C.value=!0,onError:P=>{var s;Array.isArray(e)?e.forEach(M=>l.value[M]=c[M]):l.value[e]=c,q.error(((s=P.messages)==null?void 0:s[0])||__("Error updating field"))}})}function ae(){_.value=!0}function _e(){let e=w.value[D.value];["Emails","Comments","Activities"].includes(e.name)||f.value.changeTabTo("emails"),ra(()=>f.value.emailBox.show=!0)}function ge(e){t.save.submit(null,{onSuccess:()=>Z(e)})}function Z(e){e!=null&&e.hasOwnProperty("lead_owner")&&B.reload()}return(e,a)=>{const c=H("Button"),P=H("ErrorMessage");return i(),O(oa,null,[n(Ue,null,ta({"left-header":p(()=>[n(o(Ca),{items:y.value},{prefix:p(({item:s})=>[s.icon?(i(),d(he,{key:0,icon:s.icon,class:"mr-2 h-4"},null,8,["icon"])):m("",!0)]),_:1},8,["items"])]),_:2},[v.value?void 0:{name:"right-header",fn:p(()=>{var s,M;return[(s=o(t)._actions)!=null&&s.length?(i(),d(le,{key:0,actions:o(t)._actions},null,8,["actions"])):m("",!0),(M=o(t).actions)!=null&&M.length?(i(),d(le,{key:1,actions:o(t).actions},null,8,["actions"])):m("",!0),n(Ee,{modelValue:o(B).data,"onUpdate:modelValue":a[0]||(a[0]=S=>o(B).data=S),doctype:"CRM Lead",docname:h.leadId},null,8,["modelValue","docname"]),l.value&&o(t).statuses?(i(),d(o(ue),{key:2,options:j.value,placement:"right"},{default:p(({open:S})=>[l.value.status?(i(),d(c,{key:0,label:l.value.status,iconRight:S?"chevron-up":"chevron-down"},{prefix:p(()=>[n(ze,{class:la(o(X)(l.value.status).color)},null,8,["class"])]),_:1},8,["label","iconRight"])):m("",!0)]),_:1},8,["options"])):m("",!0),n(c,{label:e.__("Convert to Deal"),variant:"solid",onClick:a[1]||(a[1]=S=>T.value=!0)},null,8,["label"])]}),key:"0"}]),1024),l.value.name?(i(),O("div",Fa,[n(o(Ge),{as:"div",modelValue:o(D),"onUpdate:modelValue":a[4]||(a[4]=s=>ie(D)?D.value=s:null),tabs:w.value},{"tab-panel":p(()=>[n(Ie,{ref_key:"activities",ref:f,doctype:"CRM Lead",docname:h.leadId,tabs:w.value,reload:C.value,"onUpdate:reload":a[2]||(a[2]=s=>C.value=s),tabIndex:o(D),"onUpdate:tabIndex":a[3]||(a[3]=s=>ie(D)?D.value=s:null),onBeforeSave:ge,onAfterSave:Z},null,8,["docname","tabs","reload","tabIndex"])]),_:1},8,["modelValue","tabs"]),n(Ce,{class:"flex flex-col justify-between border-l",side:"right"},{default:p(()=>[u("div",{class:"flex h-10.5 cursor-copy items-center border-b px-5 py-2.5 text-lg font-medium text-ink-gray-9",onClick:a[5]||(a[5]=s=>o(pa)(h.leadId))},I(e.__(h.leadId)),1),n(o(ka),{onSuccess:a[7]||(a[7]=s=>W("image",s.file_url)),validateFile:o(fa)},{default:p(({openFileSelector:s,error:M})=>[u("div",Na,[u("div",Ba,[n(o(_a),{size:"3xl",class:"size-12",label:z.value,image:l.value.image},null,8,["label","image"]),(i(),d(na(l.value.image?o(ue):"div"),sa(l.value.image?{options:[{icon:"upload",label:l.value.image?e.__("Change image"):e.__("Upload image"),onClick:s},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>W("image","")}]}:{onClick:s},{class:"!absolute bottom-0 left-0 right-0"}),{default:p(()=>[u("div",Pa,[n(qe,{class:"size-4 cursor-pointer text-white"})])]),_:1},16))]),u("div",ja,[n(o(ia),{text:l.value.lead_name||e.__("Set first name")},{default:p(()=>[u("div",Wa,I(z.value),1)]),_:1},8,["text"]),u("div",Ha,[o(ca)?(i(),d(c,{key:0,tooltip:e.__("Make a call"),icon:oe,onClick:()=>l.value.mobile_no?o(G)(l.value.mobile_no):o(q).error(e.__("No phone number set"))},null,8,["tooltip","onClick"])):m("",!0),n(c,{tooltip:e.__("Send an email"),icon:$e,onClick:S=>l.value.email?_e():o(q).error(e.__("No email set"))},null,8,["tooltip","onClick"]),n(c,{tooltip:e.__("Go to website"),icon:Oe,onClick:S=>l.value.website?o(ga)(l.value.website):o(q).error(e.__("No website set"))},null,8,["tooltip","onClick"]),n(c,{tooltip:e.__("Attach a file"),icon:te,onClick:a[6]||(a[6]=S=>F.value=!0)},null,8,["tooltip"]),g.value?(i(),d(c,{key:1,tooltip:e.__("Delete"),variant:"subtle",theme:"red",icon:"trash-2",onClick:ae},null,8,["tooltip"])):m("",!0)]),n(P,{message:e.__(M)},null,8,["message"])])])]),_:1},8,["validateFile"]),l.value.sla_status?(i(),d(Ve,{key:0,modelValue:l.value,"onUpdate:modelValue":a[8]||(a[8]=s=>l.value=s),onUpdateField:W},null,8,["modelValue"])):m("",!0),o(J).data?(i(),O("div",Qa,[n(Ne,{sections:o(J).data,doctype:"CRM Lead",docname:h.leadId,onReload:o(J).reload,onAfterFieldChange:Z},null,8,["sections","docname","onReload"])])):m("",!0)]),_:1})])):v.value?(i(),d(be,{key:1,errorTitle:v.value,errorMessage:R.value},null,8,["errorTitle","errorMessage"])):m("",!0),T.value?(i(),d(Ua,{key:2,modelValue:T.value,"onUpdate:modelValue":a[9]||(a[9]=s=>T.value=s),lead:l.value},null,8,["modelValue","lead"])):m("",!0),n(Me,{modelValue:F.value,"onUpdate:modelValue":a[10]||(a[10]=s=>F.value=s),doctype:"CRM Lead",docname:h.leadId,onAfter:a[11]||(a[11]=()=>{var s,M;(M=(s=f.value)==null?void 0:s.all_activities)==null||M.reload(),o(pe)("attachments")})},null,8,["modelValue","docname"]),_.value?(i(),d(ye,{key:3,modelValue:_.value,"onUpdate:modelValue":a[12]||(a[12]=s=>_.value=s),doctype:"CRM Lead",docname:h.leadId,name:"Leads"},null,8,["modelValue","docname"])):m("",!0)],64)}}};export{Bt as default};
//# sourceMappingURL=Lead-e69e43ee.js.map

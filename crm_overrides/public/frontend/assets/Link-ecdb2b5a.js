import{Q as F,cn as I,m as O,cy as K,cq as ee,z as $,A as R,H as te,f as d,g as q,w as x,b as Y,B as V,d as h,n as U,c as g,t as M,u as o,af as W,C as L,T as j,U as A,M as E,bW as ae,bX as se,r as H,F as Q,bY as le,L as X,N as Z,b8 as re,bZ as oe,b9 as T,Y as ne,e as ue}from"./index-f67ab40e.js";const Ye=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function G(u,k){return F(`${u}-${k+1}-01`)}function De(u,k,s){const l=G(u,k).startOf("week"),r=G(u,k).endOf("month").endOf("week"),c=[];let a=l;for(;a.isBefore(r)||a.isSame(r);){const m=a.month()===k,v=F(s);c.push({date:a,key:a.format("YYYY-MM-DD"),inMonth:m,isToday:a.isSame(I().format("YYYY-MM-DD"),"day"),isSelected:v.isValid()&&a.isSame(v,"day")}),a=a.add(1,"day")}const _=[];for(let m=0;m<c.length;m+=7)_.push(c.slice(m,m+7));return _}function Le(u){return!u||u.toString()==="Invalid Date"?"":F(u).set("hour",0).set("minute",0).set("second",0).set("millisecond",0).format("YYYY-MM-DD")}const ie={class:"w-full"},de=["onClick"],ce={key:0,class:"flex text-base leading-5 items-center truncate"},fe={class:"truncate"},me={key:1,class:"absolute text-ink-gray-4 text-left truncate w-full pr-7"},pe={class:"relative mt-1 rounded-lg bg-surface-modal text-base shadow-2xl"},ye={class:"relative px-1.5 pt-1.5"},be={key:0,class:"truncate bg-surface-modal px-2.5 py-1.5 text-sm font-medium text-ink-gray-5"},ge={class:"flex-1 truncate text-ink-gray-7"},he={key:0,class:"my-1.5 rounded-md px-2.5 py-1.5 text-base text-ink-gray-5"},ve={key:0,class:"border-t border-outline-gray-modals p-1.5"},xe={__name:"Autocomplete",props:{modelValue:{type:String,default:""},options:{type:Array,default:()=>[]},size:{type:String,default:"sm"},variant:{type:String,default:"subtle"},placeholder:{type:String,default:""},disabled:{type:Boolean,default:!1},filterable:{type:Boolean,default:!0},placement:{type:String,default:"bottom-start"}},emits:["update:modelValue","update:query","change"],setup(u,{expose:k,emit:s}){const l=u,r=s,c=O(""),a=O(!1),_=O(null),m=K(),v=ee(),D=$(()=>"value"in m),S=$({get(){return D.value?m.value:l.modelValue},set(t){c.value="",t&&(a.value=!1),r(D.value?"change":"update:modelValue",t)}});function N(){a.value=!1}const e=$(()=>{var n;return!l.options||l.options.length==0?[]:((n=l.options[0])!=null&&n.group?l.options:[{group:"",items:l.options}]).map((i,f)=>({key:f,group:i.group,hideLabel:i.hideLabel||!1,items:l.filterable?w(i.items):i.items})).filter(i=>i.items.length>0)});function w(t){return c.value?t.filter(n=>[n.label,n.value].some(f=>(f||"").toString().toLowerCase().includes(c.value.toLowerCase()))):t}function y(t){if(typeof t=="string"){let i=e.value.flatMap(f=>f.items).find(f=>f.value===t);return(i==null?void 0:i.label)||t}return t==null?void 0:t.label}R(c,t=>{r("update:query",t)}),R(a,t=>{t&&te(()=>{_.value.el.focus()})});const p=$(()=>l.disabled?"text-ink-gray-5":"text-ink-gray-8"),b=$(()=>{let t={sm:"text-base rounded h-7",md:"text-base rounded h-8",lg:"text-lg rounded-md h-10",xl:"text-xl rounded-md h-10"}[l.size],n={sm:"py-1.5 px-2",md:"py-1.5 px-2.5",lg:"py-1.5 px-3",xl:"py-1.5 px-3"}[l.size],i=l.disabled?"disabled":l.variant,f={subtle:"border border-[--surface-gray-2] bg-surface-gray-2 placeholder-ink-gray-4 hover:border-outline-gray-modals hover:bg-surface-gray-3 focus:bg-surface-white focus:border-outline-gray-4 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3",outline:"border border-outline-gray-2 bg-surface-white placeholder-ink-gray-4 hover:border-outline-gray-3 hover:shadow-sm focus:bg-surface-white focus:border-outline-gray-4 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3",disabled:["border bg-surface-menu-bar placeholder-ink-gray-3",l.variant==="outline"?"border-outline-gray-2":"border-transparent"]}[i];return[t,n,f,p.value,"transition-colors w-full"]});return k({query:c}),(t,n)=>(d(),q(o(oe),{modelValue:S.value,"onUpdate:modelValue":n[3]||(n[3]=i=>S.value=i),nullable:""},{default:x(({open:i})=>[Y(o(re),{class:"w-full",show:a.value,"onUpdate:show":n[2]||(n[2]=f=>a.value=f),placement:u.placement},{target:x(({open:f,togglePopover:z})=>[V(t.$slots,"target",j(A({open:f,togglePopover:z,isOpen:a.value,selectedValue:S.value,displayValue:y})),()=>[h("div",ie,[h("button",{class:U(["relative flex h-7 w-full items-center justify-between gap-2 rounded px-2 py-1 transition-colors",b.value]),onClick:()=>!u.disabled&&z()},[S.value?(d(),g("div",ce,[V(t.$slots,"prefix"),h("span",fe,M(y(S.value)),1)])):(d(),g("div",me,M(u.placeholder||""),1)),u.disabled?L("",!0):(d(),q(o(W),{key:2,name:"chevron-down",class:"absolute h-4 w-4 text-ink-gray-5 right-2","aria-hidden":"true"}))],10,de)])])]),body:x(({isOpen:f})=>{var z;return[E(h("div",null,[h("div",pe,[h("div",ye,[Y(o(ae),{ref_key:"search",ref:_,class:"form-input w-full focus:bg-surface-gray-3 hover:bg-surface-gray-4 text-ink-gray-8",type:"text",onChange:n[0]||(n[0]=C=>{c.value=C.target.value}),value:c.value,autocomplete:"off",placeholder:"Search"},null,8,["value"]),h("button",{class:"absolute right-1.5 inline-flex h-7 w-7 items-center justify-center",onClick:n[1]||(n[1]=C=>S.value=null)},[Y(o(W),{name:"x",class:"w-4 text-ink-gray-8"})])]),Y(o(se),{class:"my-1 max-h-[12rem] overflow-y-auto p-1.5 pt-0",static:""},{default:x(()=>[(d(!0),g(Q,null,H(e.value,C=>E((d(),g("div",{class:"mt-1.5",key:C.key},[C.group&&!C.hideLabel?(d(),g("div",be,M(C.group),1)):L("",!0),(d(!0),g(Q,null,H(C.items,B=>(d(),q(o(le),{as:"template",key:B.value,value:B},{default:x(({active:P,selected:J})=>[h("li",{class:U(["flex cursor-pointer items-center rounded px-2.5 py-1.5 text-base",{"bg-surface-gray-3":P}])},[V(t.$slots,"item-prefix",X({ref_for:!0},{active:P,selected:J,option:B})),V(t.$slots,"item-label",X({ref_for:!0},{active:P,selected:J,option:B}),()=>[h("div",ge,M(B.label),1)])],2)]),_:2},1032,["value"]))),128))])),[[Z,C.items.length>0]])),128)),e.value.length==0?(d(),g("li",he," No results found ")):L("",!0)]),_:3}),o(v).footer?(d(),g("div",ve,[V(t.$slots,"footer",j(A({value:(z=_.value)==null?void 0:z.el._value,close:N})))])):L("",!0)])],512),[[Z,f]])]}),_:3},8,["show","placement"])]),_:3},8,["modelValue"]))}},ke={class:"space-y-1.5 p-[2px] -m-[2px]"},_e={key:0,class:"flex flex-col gap-1"},we={class:"flex-1 font-semibold truncate text-ink-gray-7"},Ce={class:"flex-1 text-sm truncate text-ink-gray-5"},Ve={key:1,class:"flex-1 truncate text-ink-gray-7"},Se={key:0},$e={__name:"Link",props:{doctype:{type:String,required:!0},filters:{type:[Array,Object,String],default:[]},modelValue:{type:String,default:""},hideMe:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(u,{emit:k}){const s=u,l=k,r=K(),c=$(()=>"value"in r),a=$({get:()=>c.value?r.value:s.modelValue,set:e=>(e==null?void 0:e.value)&&l(c.value?"change":"update:modelValue",e==null?void 0:e.value)}),_=O(null),m=O("");T(()=>{var e;return(e=_.value)==null?void 0:e.query},e=>{e=e||"",m.value!==e&&(m.value=e,D(e))},{debounce:300,immediate:!0}),T(()=>s.doctype,()=>D(""),{debounce:300,immediate:!0}),T(()=>s.filters,()=>{D("",!0)},{debounce:300,immediate:!0});const v=ne({url:"frappe.desk.search.search_link",cache:[s.doctype,m.value,s.hideMe,s.filters],method:"POST",params:{txt:m.value,doctype:s.doctype,filters:s.filters},transform:e=>{let w=e.map(y=>({label:y.label||y.value,value:y.value,description:y.description}));return!s.hideMe&&s.doctype=="User"&&w.unshift({label:"@me",value:"@me"}),w}});function D(e,w=!1){var y,p,b;s.doctype&&(!w&&((y=v.data)!=null&&y.length)&&e===((p=v.params)==null?void 0:p.txt)&&s.doctype===((b=v.params)==null?void 0:b.doctype)||(v.update({params:{txt:e,doctype:s.doctype,filters:s.filters}}),v.reload()))}function S(e){l(c.value?"change":"update:modelValue",""),e()}const N=$(()=>[{sm:"text-xs",md:"text-base"}[r.size||"sm"],"text-ink-gray-5"]);return(e,w)=>{const y=ue("Button");return d(),g("div",ke,[o(r).label?(d(),g("label",{key:0,class:U(["block",N.value])},M(e.__(o(r).label)),3)):L("",!0),Y(xe,{ref_key:"autocomplete",ref:_,options:o(v).data,modelValue:a.value,"onUpdate:modelValue":w[0]||(w[0]=p=>a.value=p),size:o(r).size||"sm",variant:o(r).variant,placeholder:o(r).placeholder,disabled:o(r).disabled,placement:o(r).placement,filterable:!1},{target:x(({open:p,togglePopover:b})=>[V(e.$slots,"target",j(A({open:p,togglePopover:b})))]),prefix:x(()=>[V(e.$slots,"prefix")]),"item-prefix":x(({active:p,selected:b,option:t})=>[V(e.$slots,"item-prefix",j(A({active:p,selected:b,option:t})))]),"item-label":x(({active:p,selected:b,option:t})=>[V(e.$slots,"item-label",j(A({active:p,selected:b,option:t})),()=>[t.description?(d(),g("div",_e,[h("div",we,M(t.label),1),h("div",Ce,M(t.description),1)])):(d(),g("div",Ve,M(t.label),1))])]),footer:x(({value:p,close:b})=>[o(r).onCreate?(d(),g("div",Se,[Y(y,{variant:"ghost",class:"w-full !justify-start",label:e.__("Create New"),iconLeft:"plus",onClick:()=>o(r).onCreate(p,b)},null,8,["label","onClick"])])):L("",!0),h("div",null,[Y(y,{variant:"ghost",class:"w-full !justify-start",label:e.__("Clear"),iconLeft:"x",onClick:()=>S(b)},null,8,["label","onClick"])])]),_:3},8,["options","modelValue","size","variant","placeholder","disabled","placement"])])}}},ze=$e;export{ze as L,xe as _,G as a,Le as b,De as g,Ye as m};
//# sourceMappingURL=Link-ecdb2b5a.js.map

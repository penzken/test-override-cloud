import{_ as Q,f as i,c as _,d as C,aW as ee,O as te,P as ae,z as M,m as d,a0 as le,Y as oe,b9 as ne,F as A,r as D,b as f,w as v,u as p,g as V,C as $,t as E,H as Z,e as K,a3 as h,n as q,aO as N,aD as se}from"./index-f67ab40e.js";import{_ as re}from"./index-2d43ee63.js";import{C as ue,a as ie,b as ce,c as de,d as fe,e as ve,f as pe,g as me}from"./ComboboxViewport-2f4f3fda.js";const he={},ge={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function xe(u,m){return i(),_("svg",ge,[...m[0]||(m[0]=[C("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M13.75 7.06416V12.1549C13.75 12.9834 13.0784 13.6549 12.25 13.6549H3.75C2.92157 13.6549 2.25 12.9834 2.25 12.1549V7.06416L6.81475 9.5221C7.55469 9.92053 8.44531 9.92053 9.18525 9.5221L13.75 7.06416ZM13.7469 5.93008C13.7137 5.41511 13.4172 4.95039 12.9583 4.70457L8.70833 2.42778C8.26586 2.19074 7.73414 2.19074 7.29167 2.42778L3.04167 4.70457C2.5828 4.95039 2.28629 5.41511 2.25311 5.93008L7.28885 8.64163C7.73282 8.88069 8.26719 8.88069 8.71115 8.64163L13.7469 5.93008ZM1.25 6.02679C1.25 5.10517 1.75706 4.25829 2.56945 3.82309L6.81945 1.5463C7.55691 1.15123 8.4431 1.15123 9.18055 1.5463L13.4306 3.82309C14.2429 4.25829 14.75 5.10517 14.75 6.02679V12.1549C14.75 13.5356 13.6307 14.6549 12.25 14.6549H3.75C2.36929 14.6549 1.25 13.5356 1.25 12.1549V6.02679Z",fill:"currentColor"},null,-1)])])}const Fe=Q(he,[["render",xe]]),Ce={},_e={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function be(u,m){return i(),_("svg",_e,[...m[0]||(m[0]=[ee('<g clip-path="url(#clip0_1191_1930)"><path d="M1.45001 12.1V12.1C1.45001 11.7869 1.60364 11.4936 1.86111 11.3154L6.87595 7.84359C7.52855 7.39178 8.38658 7.36866 9.06257 7.78465L13.5984 10.5759C14.1276 10.9016 14.45 11.4786 14.45 12.1V12.1" stroke="currentColor"></path><path d="M14.45 7.60001L11.95 9.60001M4.45001 9.60001L1.45001 7.60001" stroke="currentColor"></path><path d="M4 9V3C4 2.44772 4.44772 2 5 2H11C11.5523 2 12 2.44772 12 3V9" stroke="currentColor"></path><path d="M4 4.49999L2.1786 6C1.71727 6.37992 1.45002 6.94623 1.45002 7.54385L1.45002 12.1C1.45002 13.2046 2.34545 14.1 3.45002 14.1L12.45 14.1C13.5546 14.1 14.45 13.2046 14.45 12.1V7.51988C14.45 6.93603 14.1949 6.38133 13.7516 6.00137L12 4.5" stroke="currentColor"></path><path d="M6 6H10" stroke="currentColor" stroke-linecap="round"></path><path d="M6 4H9" stroke="currentColor" stroke-linecap="round"></path></g>',1)])])}const Ie=Q(Ce,[["render",be]]),ye={class:"flex flex-wrap gap-1"},we={class:"flex-1"},ke={class:"flex flex-col gap-1 p-1 text-ink-gray-8"},Le={class:"text-base font-medium"},Me={class:"text-sm text-ink-gray-5"},Ve={key:1,class:"whitespace-pre-line text-sm text-ink-blue-3 mt-2 pl-2"},$e={__name:"EmailMultiSelect",props:te({mode:{type:String,default:null},fetchUsers:{type:Boolean,default:!1},fetchContacts:{type:Boolean,default:!1},existingEmails:{type:Array,default:()=>[]},validate:{type:Function,default:null},errorMessage:{type:Function,default:u=>`${u} is an Invalid value`},emptyPlaceholder:{type:String,default:__("No results found")},variant:{type:String,default:"subtle"},placeholder:{type:String,default:""},inputClass:{type:String,default:""}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(u,{expose:m}){const s=u,c=ae(u,"modelValue"),b=M(()=>s.mode?s.mode:s.fetchUsers?"users":s.fetchContacts?"contacts":"free"),y=d([]),H=d(null),w=d(null),L=d(null),o=d(""),k=d(!1),O=d(null),{users:S}=le(),g=d(null),P=d("");b.value==="contacts"&&(g.value=oe({url:"crm.api.contact.search_emails",method:"POST",cache:["ContactEmails"],params:{txt:""},transform:e=>{var r;let t=(e||[]).map(l=>{const n=l[0],a=l[1],x=l[2];return{label:n||x||a,value:a}});return(r=s.existingEmails)!=null&&r.length&&(t=t.filter(l=>!s.existingEmails.includes(l.value))),t}}),ne(o,e=>{var t;e=e||"",!(P.value===e&&((t=B.value)!=null&&t.length))&&(P.value=e,R(e))},{debounce:300,immediate:!0}));function R(e){b.value!=="contacts"||!g.value||(g.value.update({params:{txt:e}}),g.value.reload())}const B=M(()=>{var t,r,l;const e=b.value;if(e==="users"){let n=((t=S==null?void 0:S.data)==null?void 0:t.allUsers)||[];if(n=n.map(a=>({label:a.full_name||a.name||a.email,value:a.email})),(r=s.existingEmails)!=null&&r.length&&(n=n.filter(a=>!s.existingEmails.includes(a.value))),o.value){const a=o.value.toLowerCase();n=n.filter(x=>{var U,z;return((U=x.label)==null?void 0:U.toLowerCase().includes(a))||((z=x.value)==null?void 0:z.toLowerCase().includes(a))})}return n}if(e==="contacts"){const n=(l=g.value)!=null&&l.data?[...g.value.data]:[];return!n.length&&o.value&&n.push({label:o.value,value:o.value}),n}return o.value?[{label:o.value,value:o.value}]:[]}),W=M(()=>b.value!=="free"),Y=M(()=>b.value==="free"?__(s.emptyPlaceholder):B.value.length?"":__(s.emptyPlaceholder));function j(e){var r;if(!e)return;w.value=null,L.value=null;const t=e.split(",").map(l=>l.trim()).filter(Boolean);for(const l of t){if((r=c.value)!=null&&r.includes(l)){L.value=__("email already exists");continue}if(s.validate&&!s.validate(l)){w.value=s.errorMessage(l),o.value=l;break}c.value?c.value.push(l):c.value=[l]}}function G(e){c.value=c.value.filter(t=>t!==e)}function T(){var t;if(o.value)return;let e=(t=y.value[y.value.length-1])==null?void 0:t.rootRef;document.activeElement===e?(c.value.pop(),Z(()=>{c.value.length?(e=y.value[y.value.length-1].rootRef,e==null||e.focus()):F()})):e==null||e.focus()}function F(){var e,t;(t=(e=H.value)==null?void 0:e.focus)==null||t.call(e)}m({setFocus:F});function J(e){o.value=e.target.value,k.value=!0}function I(e){e&&(j(e),w.value||(o.value="",O.value=null,k.value=!1,Z(()=>F())))}function X(){o.value&&I(o.value)}return(e,t)=>{const r=K("FeatherIcon"),l=K("Button"),n=K("ErrorMessage");return i(),_("div",null,[C("div",ye,[(i(!0),_(A,null,D(c.value,a=>(i(),V(l,{ref_for:!0,ref_key:"emails",ref:y,key:a,label:a,theme:"gray",variant:"subtle",class:q({"rounded bg-surface-white hover:!bg-surface-gray-1 focus-visible:ring-outline-gray-4":u.variant==="subtle"}),onKeydownCapture:N(h(T,["stop"]),["delete"])},{suffix:v(()=>[f(r,{class:"h-3.5",name:"x",onClick:h(x=>G(a),["stop"])},null,8,["onClick"])]),_:2},1032,["label","class","onKeydownCapture"]))),128)),C("div",we,[f(p(me),{"model-value":O.value,open:k.value,"onUpdate:open":t[3]||(t[3]=a=>k.value=a),"onUpdate:modelValue":I,"ignore-filter":!0},{default:v(()=>[f(p(ue),{class:q(["flex h-7 max-w-full w-auto items-center gap-2 rounded px-2 py-1 border border-transparent",[u.variant=="ghost"?"bg-surface-white hover:bg-surface-white":"bg-surface-gray-2 hover:bg-surface-gray-3",u.inputClass]])},{default:v(()=>[f(p(ie),{ref_key:"search",ref:H,value:o.value,autocomplete:"off",class:"bg-transparent p-0 outline-none border-0 text-base text-ink-gray-8 h-full placeholder:text-ink-gray-4 w-full focus:outline-none focus:ring-0 focus:border-0",placeholder:u.placeholder,onFocus:t[0]||(t[0]=a=>k.value=!0),onInput:J,onKeydownCapture:N(h(T,["stop"]),["delete"]),onKeydown:N(h(X,["prevent"]),["enter"])},null,8,["value","placeholder","onKeydownCapture","onKeydown"])]),_:1},8,["class"]),f(p(ce),null,{default:v(()=>[f(p(de),{class:"z-10 mt-1 min-w-48 w-auto max-w-96 bg-surface-modal overflow-hidden rounded-lg shadow-2xl ring-1 ring-black ring-opacity-5",position:"popper",align:"start",onOpenAutoFocus:t[1]||(t[1]=h(()=>{},["prevent"])),onCloseAutoFocus:t[2]||(t[2]=h(()=>{},["prevent"]))},{default:v(()=>[f(p(fe),{class:"max-h-60 overflow-auto p-1.5"},{default:v(()=>[f(p(ve),{class:"flex gap-2 rounded px-2 py-1 text-base text-ink-gray-5"},{default:v(()=>[W.value?(i(),V(r,{key:0,name:"search",class:"h-4"})):$("",!0),se(" "+E(Y.value),1)]),_:1}),(i(!0),_(A,null,D(B.value,a=>(i(),V(p(pe),{key:a.value,value:a.value,class:"text-base leading-none text-ink-gray-7 rounded flex items-center px-2 py-1 relative select-none data-[highlighted]:outline-none data-[highlighted]:bg-surface-gray-3 cursor-pointer",onMousedown:h(x=>I(a.value),["prevent"])},{default:v(()=>[f(re,{class:"mr-2",user:a.value,size:"lg"},null,8,["user"]),C("div",ke,[C("div",Le,E(a.label),1),C("div",Me,E(a.value),1)])]),_:2},1032,["value","onMousedown"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value","open"])])]),w.value?(i(),V(n,{key:0,class:"mt-2 pl-2",message:w.value},null,8,["message"])):$("",!0),L.value?(i(),_("div",Ve,E(L.value),1)):$("",!0)])}}};export{Fe as E,$e as _,Ie as a};
//# sourceMappingURL=EmailMultiSelect-1d21e296.js.map
